<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>浩翰Redamancy的博客</title>
  
  <subtitle>一个爱学习的计算机菜鸟笔记</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-09-05T13:06:21.164Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>精神小伙</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>tracert命令详解</title>
    <link href="http://yoursite.com/2019/09/05/tracert%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/"/>
    <id>http://yoursite.com/2019/09/05/tracert命令详解/</id>
    <published>2019-09-05T13:01:50.000Z</published>
    <updated>2019-09-05T13:06:21.164Z</updated>
    
    <content type="html"><![CDATA[<h2 id="tracert命令"><a href="#tracert命令" class="headerlink" title="tracert命令"></a>tracert命令</h2><p>Tracert是路由跟踪程序，用于确定 IP 数据报访问目标所经过的路径。Tracert 命令用 IP 生存时间 (TTL) 字段和 ICMP 错误消息来确定从一个主机到网络上其他主机的路由。 在工作环境中有多条链路出口时，可以通过该命令查询数据是经过的哪一条链路出口。</p><p>Tracert一般用来检测故障的位置，我们可以使用用tracert IP命令确定数据包在网络上的停止位置，来判断在哪个环节上出了问题，虽然还是没有确定是什么问题，但它已经告诉了我们问题所在的地方，方便检测网络中存在的问题。</p><p><img src="1.png" alt="网络"></p><h2 id="Tracert工作原理"><a href="#Tracert工作原理" class="headerlink" title="Tracert工作原理"></a>Tracert工作原理</h2><p>通过向目标发送不同 IP 生存时间 (TTL) 值的“Internet 控制消息协议 (ICMP)”回应数据包，Tracert 诊断程序确定到目标所采取的路由。要求路径上的每个路由器在转发数据包之前至少将数据包上的 TTL 递减 1。数据包上的 TTL 减为 0 时，路由器应该将“ICMP 已超时”的消息发回源系统。</p><p>Tracert 先发送 TTL 为 1 的回应数据包，并在随后的每次发送过程将 TTL 递增 1，直到目标响应或 TTL 达到最大值，从而确定路由。通过检查中间路由器发回的“ICMP 已超时”的消息确定路由。某些路由器不经询问直接丢弃 TTL 过期的数据包，这在 Tracert 实用程序中看不到。</p><p>Tracert 命令按顺序打印出返回“ICMP 已超时”消息的路径中的近端路由器接口列表。如果使用 -d 选项，则 Tracert 实用程序不在每个 IP 地址上查询 DNS。</p><h2 id="不带选项"><a href="#不带选项" class="headerlink" title="不带选项"></a>不带选项</h2><p><img src="2.png" alt="网络"></p><p>不带选项的tracert命令将显示到达目标IP地址所经过的路径，并将IP地址解析为主机名一同显示。如下图所示，第一跳是网关地址，可以根据看到的主机名，判断我使用的是极路由。</p><p><img src="3.png" alt="网络"></p><p>根据上面的跟踪结果，画出从自己的主机出发到达<a href="http://www.heuet.edu.cn的网络结构" target="_blank" rel="noopener">www.heuet.edu.cn的网络结构</a></p><p>根据tracert命令输出的信息可知,第一行为我所在网段的网关<br>第二到第四行为所经过路由的网关</p><p><img src="3.png" alt="网络"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;tracert命令&quot;&gt;&lt;a href=&quot;#tracert命令&quot; class=&quot;headerlink&quot; title=&quot;tracert命令&quot;&gt;&lt;/a&gt;tracert命令&lt;/h2&gt;&lt;p&gt;Tracert是路由跟踪程序，用于确定 IP 数据报访问目标所经过的路径。Trace
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>win10下用IDEA+Hadoop运行时的环境搭建</title>
    <link href="http://yoursite.com/2019/08/31/win10%E4%B8%8B%E7%94%A8IDEA-Hadoop%E8%BF%90%E8%A1%8C%E6%97%B6%E7%9A%84%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <id>http://yoursite.com/2019/08/31/win10下用IDEA-Hadoop运行时的环境搭建/</id>
    <published>2019-08-31T04:00:05.000Z</published>
    <updated>2019-08-31T04:46:20.595Z</updated>
    
    <content type="html"><![CDATA[<h1 id="构建win10下用IDEA运行Hadoop程序"><a href="#构建win10下用IDEA运行Hadoop程序" class="headerlink" title="构建win10下用IDEA运行Hadoop程序"></a>构建win10下用IDEA运行Hadoop程序</h1><h2 id="本地解压hadoop安装包："><a href="#本地解压hadoop安装包：" class="headerlink" title="本地解压hadoop安装包："></a>本地解压hadoop安装包：</h2><p>如图</p><p><img src="image001.png" alt="Hadoop"></p><p>2.将hadoop添加到环境变量中</p><p><img src="image003.png" alt="Hadoop"></p><p><img src="image005.png" alt="Hadoop"></p><p>在Path变量中添加</p><p><img src="image007.png" alt="Hadoop"></p><p>下载<a href="https://github.com/steveloughran/winutils" target="_blank" rel="noopener">winutils工具</a>,将bin目录覆盖到解压的hadoop安装包中</p><p>3.在IDEA中构建新项目：</p><blockquote><p>注意：IDEA必须下载专业版</p></blockquote><p>打开之后：</p><p><img src="image009.png" alt="Hadoop"></p><p>如图</p><p><img src="image011.png" alt="Hadoop"></p><p>创建完项目之后，打开porn.xml文件：</p><p>添加配置项</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>java_Hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java_Hadoop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-hdfs<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>相关的包自己会从官网下载</p><h2 id="具体实现代码："><a href="#具体实现代码：" class="headerlink" title="具体实现代码："></a>具体实现代码：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> hdfs;  <span class="comment">//包</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileStatus;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListHdfsFile</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Configuration configuration;  <span class="comment">// 静态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> FileSystem fs ;          <span class="comment">//定义两个抽象对象</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        configuration = <span class="keyword">new</span> Configuration();</span><br><span class="line">        configuration.set(<span class="string">"fs.defaultFS"</span>, <span class="string">"172.18.74.68:9000"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fs = FileSystem.get(configuration);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">listFileDir</span><span class="params">(Path p)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        FileStatus[] statuses = fs.listStatus(p);</span><br><span class="line">        <span class="keyword">for</span> (FileStatus status : statuses) &#123;</span><br><span class="line">            Path path = status.getPath();</span><br><span class="line">            String name = path.getName();</span><br><span class="line">            System.out.println(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;                  <span class="comment">//类的封装</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Path path = <span class="keyword">new</span> Path(<span class="string">"/"</span>);   <span class="comment">//定义的 listFileDir函数实现</span></span><br><span class="line">        listFileDir(path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;构建win10下用IDEA运行Hadoop程序&quot;&gt;&lt;a href=&quot;#构建win10下用IDEA运行Hadoop程序&quot; class=&quot;headerlink&quot; title=&quot;构建win10下用IDEA运行Hadoop程序&quot;&gt;&lt;/a&gt;构建win10下用IDEA运行Ha
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>CentOS7关闭SELinux</title>
    <link href="http://yoursite.com/2019/08/31/CentOS7%E5%85%B3%E9%97%ADSELinux/"/>
    <id>http://yoursite.com/2019/08/31/CentOS7关闭SELinux/</id>
    <published>2019-08-31T02:36:24.000Z</published>
    <updated>2019-08-31T02:37:52.277Z</updated>
    
    <content type="html"><![CDATA[<h2 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h2><p><code>[root@dev-server ~]# getenforce</code></p><p>Disabled</p><p><code>[root@dev-server ~]# /usr/sbin/sestatus -v</code></p><p>SELinux status:                 disabled</p><h2 id="临时关闭"><a href="#临时关闭" class="headerlink" title="临时关闭"></a>临时关闭</h2><h3 id="设置SELinux-成为permissive模式"><a href="#设置SELinux-成为permissive模式" class="headerlink" title="设置SELinux 成为permissive模式"></a>设置SELinux 成为permissive模式</h3><h3 id="setenforce-1-设置SELinux-成为enforcing模式"><a href="#setenforce-1-设置SELinux-成为enforcing模式" class="headerlink" title="setenforce 1 设置SELinux 成为enforcing模式"></a>setenforce 1 设置SELinux 成为enforcing模式</h3><p><code>setenforce 0</code></p><h3 id="永久关闭"><a href="#永久关闭" class="headerlink" title="永久关闭"></a>永久关闭</h3><p><code>vi /etc/selinux/config</code></p><p>将<code>SELINUX=enforcing</code>改为<code>SELINUX=disabled</code></p><p>设置后需要重启才能生效</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;查看&quot;&gt;&lt;a href=&quot;#查看&quot; class=&quot;headerlink&quot; title=&quot;查看&quot;&gt;&lt;/a&gt;查看&lt;/h2&gt;&lt;p&gt;&lt;code&gt;[root@dev-server ~]# getenforce&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Disabled&lt;/p&gt;
&lt;p&gt;&lt;c
      
    
    </summary>
    
      <category term="Liunx" scheme="http://yoursite.com/categories/Liunx/"/>
    
    
      <category term="Liunx" scheme="http://yoursite.com/tags/Liunx/"/>
    
  </entry>
  
  <entry>
    <title>在Centos 7下安装PHP 7</title>
    <link href="http://yoursite.com/2019/08/31/%E5%9C%A8Centos%207%E4%B8%8B%E5%AE%89%E8%A3%85PHP%207/"/>
    <id>http://yoursite.com/2019/08/31/在Centos 7下安装PHP 7/</id>
    <published>2019-08-31T02:36:24.000Z</published>
    <updated>2019-09-05T12:56:38.355Z</updated>
    
    <content type="html"><![CDATA[<p>CentOS 7的官方软件源中，只有PHP 5.4这个官方已经不再提供技术支持的老版本。</p><p>不仅仅是为了安全原因，只是PHP 7中的那些新特性，就要求我们必须更新到新版本下。</p><h2 id="启用EPEL和REMI软件源"><a href="#启用EPEL和REMI软件源" class="headerlink" title="启用EPEL和REMI软件源"></a>启用EPEL和REMI软件源</h2><p>执行以下指令，分别安装EPEL和Remi软件源：</p><pre><code>yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpmyum install http://rpms.remirepo.net/enterprise/remi-release-7.rpm</code></pre><h2 id="安装yum包管理工具"><a href="#安装yum包管理工具" class="headerlink" title="安装yum包管理工具"></a>安装yum包管理工具</h2><p>默认安装的yum软件包管理工具，自身的管理工具yum-utils（主要是提供了yum-config-manager，用于启用/禁用yum软件库）没有安装。</p><p><code>yum install yum-utils</code></p><h2 id="启用PHP7软件库"><a href="#启用PHP7软件库" class="headerlink" title="启用PHP7软件库"></a>启用PHP7软件库</h2><p>启用PHP 7.2软件库</p><p><code>yum-config-manager --enable remi-php72</code></p><p>如果要启用PHP7.0/7.1软件库，选择执行以下指令：</p><pre><code>yum-config-manager --enable remi-php70   [Install PHP 7.0]yum-config-manager --enable remi-php71   [Install PHP 7.1]</code></pre><h2 id="安装PHP-7"><a href="#安装PHP-7" class="headerlink" title="安装PHP 7"></a>安装PHP 7</h2><h3 id="更新软件库索引"><a href="#更新软件库索引" class="headerlink" title="更新软件库索引"></a>更新软件库索引</h3><p><code>yum update</code></p><p>查看将要安装的php信息：</p><p><code>yum info php</code></p><p>如果能看到 7.2.3 字样，表示可以正常安装了</p><h3 id="查看即将安装的PHP版本"><a href="#查看即将安装的PHP版本" class="headerlink" title="查看即将安装的PHP版本"></a>查看即将安装的PHP版本</h3><p>执行以下指令安装：</p><p><code>yum install php php-mcrypt php-cli php-gd php-curl php-mysql php-ldap php-zip php-fileinfo</code></p><p>验证PHP版本</p><p>php -v</p><h3 id="重启httpd服务"><a href="#重启httpd服务" class="headerlink" title="重启httpd服务"></a>重启httpd服务</h3><p><code>systemctl restart httpd</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CentOS 7的官方软件源中，只有PHP 5.4这个官方已经不再提供技术支持的老版本。&lt;/p&gt;
&lt;p&gt;不仅仅是为了安全原因，只是PHP 7中的那些新特性，就要求我们必须更新到新版本下。&lt;/p&gt;
&lt;h2 id=&quot;启用EPEL和REMI软件源&quot;&gt;&lt;a href=&quot;#启用EPE
      
    
    </summary>
    
      <category term="Liunx" scheme="http://yoursite.com/categories/Liunx/"/>
    
    
      <category term="Liunx" scheme="http://yoursite.com/tags/Liunx/"/>
    
  </entry>
  
  <entry>
    <title>解决vmware（vsphere）部署linux系统模板后无法联网问题</title>
    <link href="http://yoursite.com/2019/08/31/%E8%A7%A3%E5%86%B3vmware%EF%BC%88vsphere%EF%BC%89%E9%83%A8%E7%BD%B2linux%E7%B3%BB%E7%BB%9F%E6%A8%A1%E6%9D%BF%E5%90%8E%E6%97%A0%E6%B3%95%E8%81%94%E7%BD%91%E9%97%AE%E9%A2%98/"/>
    <id>http://yoursite.com/2019/08/31/解决vmware（vsphere）部署linux系统模板后无法联网问题/</id>
    <published>2019-08-31T02:33:24.000Z</published>
    <updated>2019-08-31T02:36:02.946Z</updated>
    
    <content type="html"><![CDATA[<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>使用vmware（vsphere）部署linux的ova（ovf）模板后，会发现系统启动后无法联网。这是因为ifcfg-eth0配置文件中保存的MAC地址与当前系统实际的MAC地址不一致引起的。可通过如下步骤解决：</p><p>删除ifcfg-eth0配置文件中的HWADDR行</p><ul><li>删除HWADDR所在行内容</li></ul><p>删除70-persistent-net.rules文件</p><p><code>rm /etc/udev/rules.d/70-persistent-net.rules</code></p><p>重启网卡或者重启系统</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;解决&quot;&gt;&lt;a href=&quot;#解决&quot; class=&quot;headerlink&quot; title=&quot;解决&quot;&gt;&lt;/a&gt;解决&lt;/h2&gt;&lt;p&gt;使用vmware（vsphere）部署linux的ova（ovf）模板后，会发现系统启动后无法联网。这是因为ifcfg-eth0配置文件中保
      
    
    </summary>
    
      <category term="Liunx" scheme="http://yoursite.com/categories/Liunx/"/>
    
      <category term="Vmware" scheme="http://yoursite.com/categories/Liunx/Vmware/"/>
    
    
      <category term="Liunx" scheme="http://yoursite.com/tags/Liunx/"/>
    
      <category term="Vmware" scheme="http://yoursite.com/tags/Vmware/"/>
    
  </entry>
  
  <entry>
    <title>HDFS文件接口</title>
    <link href="http://yoursite.com/2019/08/31/HDFS%E6%96%87%E4%BB%B6%E6%8E%A5%E5%8F%A3/"/>
    <id>http://yoursite.com/2019/08/31/HDFS文件接口/</id>
    <published>2019-08-31T02:12:44.000Z</published>
    <updated>2019-08-31T02:53:12.111Z</updated>
    
    <content type="html"><![CDATA[<h2 id="命令基本格式"><a href="#命令基本格式" class="headerlink" title="命令基本格式:"></a>命令基本格式:</h2><p><code>hadoop fs -cmd &lt; args &gt;</code></p><hr><ol><li>ls</li></ol><p><code>hadoop fs -ls  /</code></p><p>列出hdfs文件系统根目录下的目录和文件</p><p><code>hadoop fs -ls -R /</code></p><p>列出hdfs文件系统所有的目录和文件</p><hr><ol start="2"><li>put</li></ol><p><code>hadoop fs -put &lt; local file &gt; &lt; hdfs file &gt;</code></p><p>hdfs file的父目录一定要存在，否则命令不会执行</p><p><code>hadoop fs -put  &lt; local file or dir &gt;...&lt; hdfs dir &gt;</code></p><p>hdfs dir 一定要存在，否则命令不会执行</p><p><code>hadoop fs -put - &lt; hdsf  file&gt;</code></p><p>从键盘读取输入到hdfs file中，按Ctrl+D结束输入，hdfs file不能存在，否则命令不会执行</p><ol start="3"><li>moveFromLocal</li></ol><p><code>hadoop fs -moveFromLocal  &lt; local src &gt; ... &lt; hdfs dst &gt;</code></p><p>与put相类似，命令执行后源文件 local src 被删除，也可以从从键盘读取输入到hdfs file中</p><ol start="4"><li>copyFromLocal</li></ol><p><code>hadoop fs -copyFromLocal  &lt; local src &gt; ... &lt; hdfs dst &gt;</code></p><p>与put相类似，也可以从从键盘读取输入到hdfs file中</p><hr><ol start="5"><li>get</li></ol><p><code>hadoop fs -get &lt; hdfs file &gt; &lt; local file or dir&gt;</code></p><p>local file不能和 hdfs file名字不能相同，否则会提示文件已存在，没有重名的文件会复制到本地</p><p><code>hadoop fs -get &lt; hdfs file or dir &gt; ... &lt; local  dir &gt;</code></p><p>拷贝多个文件或目录到本地时，本地要为文件夹路径</p><p>注意：如果用户不是root， local 路径要为用户文件夹下的路径，否则会出现权限问题，</p><ol start="6"><li>copyToLocal</li></ol><p><code>hadoop fs -copyToLocal &lt; local src &gt; ... &lt; hdfs dst &gt;</code></p><p>与get相类似</p><hr><ol start="7"><li>rm</li></ol><p><code>hadoop fs -rm &lt; hdfs file &gt; ...</code></p><p><code>hadoop fs -rm -r &lt; hdfs dir&gt;...</code></p><p>每次可以删除多个文件或目录</p><hr><ol start="8"><li>mkdir</li></ol><p><code>hadoop fs -mkdir &lt; hdfs path&gt;</code></p><p>只能一级一级的建目录，父目录不存在的话使用这个命令会报错</p><p><code>hadoop fs -mkdir -p &lt; hdfs path&gt;</code></p><p>所创建的目录如果父目录不存在就创建该父目录</p><hr><ol start="9"><li>getmerge</li></ol><p><code>hadoop fs -getmerge &lt; hdfs dir &gt;  &lt; local file &gt;</code></p><p>将hdfs指定目录下所有文件排序后合并到local指定的文件中，文件不存在时会自动创建，文件存在时会覆盖里面的内容</p><p><code>hadoop fs -getmerge -nl  &lt; hdfs dir &gt;  &lt; local file &gt;</code></p><p>加上nl后，合并到local file中的hdfs文件之间会空出一行</p><hr><ol start="10"><li>cp</li></ol><p><code>hadoop fs -cp  &lt; hdfs file &gt;  &lt; hdfs file &gt;</code></p><p>目标文件不能存在，否则命令不能执行，相当于给文件重命名并保存，源文件还存在</p><p><code>hadoop fs -cp &lt; hdfs file or dir &gt;... &lt; hdfs dir &gt;</code></p><p>目标文件夹要存在，否则命令不能执行</p><hr><ol start="11"><li>mv</li></ol><p><code>hadoop fs -mv &lt; hdfs file &gt;  &lt; hdfs file &gt;</code></p><p>目标文件不能存在，否则命令不能执行，相当于给文件重命名并保存，源文件不存在</p><p><code>hadoop fs -mv  &lt; hdfs file or dir &gt;...  &lt; hdfs dir &gt;</code></p><p>源路径有多个时，目标路径必须为目录，且必须存在。</p><p>注意：跨文件系统的移动（local到hdfs或者反过来）都是不允许的</p><hr><ol start="12"><li>count</li></ol><p><code>hadoop fs -count &lt; hdfs path &gt;</code></p><p>统计hdfs对应路径下的目录个数，文件个数，文件总计大小</p><p>显示为目录个数，文件个数，文件总计大小，输入路径</p><h2 id="HDFS-JavaAPI"><a href="#HDFS-JavaAPI" class="headerlink" title="HDFS JavaAPI"></a>HDFS JavaAPI</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Hdfs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.xml.internal.ws.api.ha.StickyFeature;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hdfs.util.IOUtilsClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IOUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HdfsTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span>   &#123;</span><br><span class="line">        <span class="comment">//部署在远程服务器上的集群</span></span><br><span class="line">        conf.set(<span class="string">"fs.defaultFS"</span>, <span class="string">"172.18.74.236:9000"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建新文件</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createFile</span><span class="params">(String dst, <span class="keyword">byte</span>[] contents)</span> <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        FileSystem fs = FileSystem.get(conf);</span><br><span class="line">        Path dstPath = <span class="keyword">new</span> Path(dst);<span class="comment">//目标路径</span></span><br><span class="line">        <span class="comment">//打开一个输出流</span></span><br><span class="line">        FSDataOutputStream outputStream = fs.create(dstPath);</span><br><span class="line">        outputStream.write(contents);</span><br><span class="line">        outputStream.close();</span><br><span class="line">        fs.close();</span><br><span class="line">        System.out.println(<span class="string">"文件创建成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将本地文件导入到Hdfs中</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">uploadFile</span><span class="params">(String src,String dst)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        <span class="comment">//Configuration conf = new Configuration();</span></span><br><span class="line">        FileSystem fs = FileSystem.get(conf);</span><br><span class="line">        Path srcPath = <span class="keyword">new</span> Path(src); <span class="comment">//本地上传文件路径</span></span><br><span class="line">        Path dstPath = <span class="keyword">new</span> Path(dst); <span class="comment">//hdfs目标路径</span></span><br><span class="line">        <span class="comment">//调用文件系统的文件复制函数,前面参数是指是否删除原文件，true为删除，默认为false</span></span><br><span class="line">        fs.copyFromLocalFile(<span class="keyword">false</span>, srcPath, dstPath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//打印文件路径</span></span><br><span class="line">        System.out.println(<span class="string">"Upload to "</span>+conf.get(<span class="string">"fs.default.name"</span>));</span><br><span class="line">        System.out.println(<span class="string">"------------list files------------"</span>+<span class="string">"\n"</span>);</span><br><span class="line">        FileStatus [] fileStatus = fs.listStatus(dstPath);</span><br><span class="line">        <span class="keyword">for</span> (FileStatus file : fileStatus)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(file.getPath());</span><br><span class="line">        &#125;</span><br><span class="line">        fs.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">upload</span><span class="params">(String src,String dst)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        FileSystem fs = FileSystem.get(conf);</span><br><span class="line"></span><br><span class="line">        Path dstPath = <span class="keyword">new</span> Path(dst); <span class="comment">//hdfs目标路径</span></span><br><span class="line">        FSDataOutputStream os = fs.create(dstPath);</span><br><span class="line">        FileInputStream is = <span class="keyword">new</span> FileInputStream(src);</span><br><span class="line"></span><br><span class="line">        org.apache.commons.io.IOUtils.copy(is,os);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//文件重命名</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">rename</span><span class="params">(String oldName, String newName)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        FileSystem fs = FileSystem.get(conf);</span><br><span class="line"></span><br><span class="line">        Path oldPath = <span class="keyword">new</span> Path(oldName);</span><br><span class="line">        Path newPath = <span class="keyword">new</span> Path(newName);</span><br><span class="line">        <span class="keyword">boolean</span> isok = fs.rename(oldPath, newPath);</span><br><span class="line">        <span class="keyword">if</span>(isok)&#123;</span><br><span class="line">            System.out.println(<span class="string">"rename ok!"</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"rename failure"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fs.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除文件</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(String filePath)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        FileSystem fs = FileSystem.get(conf);</span><br><span class="line"></span><br><span class="line">        Path path = <span class="keyword">new</span> Path(filePath);</span><br><span class="line">        <span class="keyword">boolean</span> isok = fs.deleteOnExit(path);</span><br><span class="line">        <span class="keyword">if</span>(isok)&#123;</span><br><span class="line">            System.out.println(<span class="string">"delect ok"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"delect failure"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fs.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建目录</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mkdir</span><span class="params">(String path)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line"></span><br><span class="line">        FileSystem fs = FileSystem.get(conf);</span><br><span class="line"></span><br><span class="line">        Path srcPath = <span class="keyword">new</span> Path(path);</span><br><span class="line">        <span class="keyword">boolean</span> isok = fs.mkdirs(srcPath);</span><br><span class="line">        <span class="keyword">if</span> (isok)&#123;</span><br><span class="line">            System.out.println(<span class="string">"create "</span> + path + <span class="string">" dir ok !"</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"create "</span>+ path +<span class="string">" dir failure!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        fs.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读取文件中的内容</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">readFile</span><span class="params">(String filePath)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        FileSystem fs = FileSystem.get(conf);</span><br><span class="line"></span><br><span class="line">        Path fielPath = <span class="keyword">new</span> Path(filePath);</span><br><span class="line">        InputStream in =<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            in =fs.open(fielPath);</span><br><span class="line">            IOUtils.copyBytes(in, System.out, <span class="number">4096</span>, <span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            IOUtils.closeStream(in);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 遍历制定目录下的所有文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getDiretoryFromHdfs</span><span class="params">(String direPath)</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileSystem fs = FileSystem.get(conf);</span><br><span class="line">            FileStatus[] filelist = fs.listStatus(<span class="keyword">new</span> Path(direPath));</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; filelist.length; i++)&#123;</span><br><span class="line">                System.out.println(<span class="string">"______"</span> + direPath + <span class="string">"目录下的所有文件_________"</span>);</span><br><span class="line">                FileStatus fileStatus = filelist[i];</span><br><span class="line">                System.out.println(<span class="string">"Name: "</span>+fileStatus.getPath().getName());</span><br><span class="line">                System.out.println(<span class="string">"Size: "</span>+fileStatus.getLen());</span><br><span class="line">                System.out.println(<span class="string">"Path: "</span>+ fileStatus.getPath());</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            fs.close();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line"></span><br><span class="line">        String today = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).format(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        String localFilePath = <span class="string">"C:\\Users\\Charon\\Desktop\\To do.txt"</span>;</span><br><span class="line">        String hdfsFilePath = <span class="string">"/Test"</span> +today.substring(<span class="number">0</span>,<span class="number">7</span>) + <span class="string">"/upload_date="</span> + today + <span class="string">"/"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 遍历根目录下的所有文件</span></span><br><span class="line">        getDiretoryFromHdfs(<span class="string">"/"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 新建目录</span></span><br><span class="line"><span class="comment">//        mkdir(hdfsFilePath);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 上传文件</span></span><br><span class="line"><span class="comment">//        uploadFile(localFilePath,hdfsFilePath);</span></span><br><span class="line"><span class="comment">//        getDiretoryFromHdfs(hdfsFilePath);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 读取文件</span></span><br><span class="line"><span class="comment">//        readFile("hdfs://172.18.74.236:9000/Test2019-05/upload_date=2019-05-26/To do.txt");</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 重命名</span></span><br><span class="line"><span class="comment">//        rename("hdfs://172.18.74.236:9000/Test2019-05/upload_date=2019-05-26/To do.txt","hdfs://172.18.74.236:9000/Test2019-05/upload_date=2019-05-26/Test.txt");</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//6. 创建文件，并向文件写入内容</span></span><br><span class="line"><span class="comment">//        byte[] contents = "\n2019年5月26日20:22:37 添加写入内容\n".getBytes();</span></span><br><span class="line"><span class="comment">//        createFile("hdfs://172.18.74.236:9000/Test2019-05/upload_date=2019-05-26/Test1.txt",contents);</span></span><br><span class="line"><span class="comment">//        readFile("hdfs://172.18.74.236:9000/Test2019-05/upload_date=2019-05-26/Test1.txt");</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//7. 删除文件</span></span><br><span class="line">        delect(hdfsFilePath);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;命令基本格式&quot;&gt;&lt;a href=&quot;#命令基本格式&quot; class=&quot;headerlink&quot; title=&quot;命令基本格式:&quot;&gt;&lt;/a&gt;命令基本格式:&lt;/h2&gt;&lt;p&gt;&lt;code&gt;hadoop fs -cmd &amp;lt; args &amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;hr&gt;

      
    
    </summary>
    
      <category term="Hadoop" scheme="http://yoursite.com/categories/Hadoop/"/>
    
    
      <category term="Hadoop" scheme="http://yoursite.com/tags/Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>JobTracker和TaskTracker</title>
    <link href="http://yoursite.com/2019/08/31/JobTracker%E5%92%8CTaskTracker/"/>
    <id>http://yoursite.com/2019/08/31/JobTracker和TaskTracker/</id>
    <published>2019-08-31T02:12:44.000Z</published>
    <updated>2019-08-31T03:51:44.820Z</updated>
    
    <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Hadoop MapReduce采用Master/Slave结构。</p><ul><li><p>Master：是整个集群的唯一的全局管理者，功能包括：作业管理、状态监控和任务调度等，即MapReduce中的JobTracker。</p></li><li><p>Slave：负责任务的执行和任务状态的回报，即MapReduce中的TaskTracker。</p></li></ul><h2 id="JobTracker剖析"><a href="#JobTracker剖析" class="headerlink" title="JobTracker剖析"></a>JobTracker剖析</h2><h3 id="概述：JobTracker是一个后台服务进程，启动之后，会一直监听并接收来自各个TaskTracker发送的心跳信息，包括资源使用情况和任务运行情况等信息"><a href="#概述：JobTracker是一个后台服务进程，启动之后，会一直监听并接收来自各个TaskTracker发送的心跳信息，包括资源使用情况和任务运行情况等信息" class="headerlink" title="概述：JobTracker是一个后台服务进程，启动之后，会一直监听并接收来自各个TaskTracker发送的心跳信息，包括资源使用情况和任务运行情况等信息"></a>概述：JobTracker是一个后台服务进程，启动之后，会一直监听并接收来自各个TaskTracker发送的心跳信息，包括资源使用情况和任务运行情况等信息</h3><h3 id="JobTracker的主要功能"><a href="#JobTracker的主要功能" class="headerlink" title="JobTracker的主要功能"></a>JobTracker的主要功能</h3><ul><li><p>作业控制：在hadoop中每个应用程序被表示成一个作业，每个作业又被分成多个任务，JobTracker的作业控制模块则负责作业的分解和状态监控。</p></li><li><p>最重要的是状态监控：主要包括TaskTracker状态监控、作业状态监控和任务状态监控。</p></li></ul><p>主要作用：</p><ul><li>容错和为任务调度提供决策依据</li><li>资源管理。</li></ul><h2 id="TaskTracker剖析"><a href="#TaskTracker剖析" class="headerlink" title="TaskTracker剖析"></a>TaskTracker剖析</h2><h3 id="TaskTracker概述"><a href="#TaskTracker概述" class="headerlink" title="TaskTracker概述"></a>TaskTracker概述</h3><p>TaskTracker是JobTracker和Task之间的桥梁：一方面，从JobTracker接收并执行各种命令：运行任务、提交任务、杀死任务等；另一方面，将本地节点上各个任务的状态通过心跳周期性汇报给JobTracker。TaskTracker与JobTracker和Task之间采用了RPC协议进行通信。</p><h3 id="TaskTracker的功能："><a href="#TaskTracker的功能：" class="headerlink" title="TaskTracker的功能："></a>TaskTracker的功能：</h3><ol><li>汇报心跳：Tracker周期性将所有节点上各种信息通过心跳机制汇报给<br>JobTracker。这些信息包括两部分：</li></ol><p>*机器级别信息：节点健康情况、资源使用情况等。</p><p>*任务级别信息：任务执行进度、任务运行状态等。</p><ol start="2"><li>执行命令：JobTracker会给TaskTracker下达各种命令，主要包括：启动任务(LaunchTaskAction)、提交任务(CommitTaskAction)、杀死任务(KillTaskAction)、杀死作业(KillJobAction)和重新初始化(TaskTrackerReinitAction)。</li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>JobTracker  对应于 NameNode</p><p>TaskTracker 对应于 DataNode</p><p>DataNode 和NameNode 是针对数据存放来而言的</p><p>JobTracker和TaskTracker是对于MapReduce执行而言的</p><p>mapreduce中几个主要概念，mapreduce整体上可以分为这么几条执行线索：</p><p>jobclient，JobTracker与TaskTracker。</p><ol><li>JobClient会在用户端通过JobClient类将应用已经配置参数打包成jar文件存储到hdfs，</li></ol><p>并把路径提交到Jobtracker,然后由JobTracker创建每一个Task（即MapTask和ReduceTask）</p><p>并将它们分发到各个TaskTracker服务中去执行</p><ol start="2"><li>JobTracker是一个master服务，软件启动之后JobTracker接收Job，负责调度Job的每一个子任务task运行于TaskTracker上，</li></ol><p>并监控它们，如果发现有失败的task就重新运行它。一般情况应该把JobTracker部署在单独的机器上。</p><ol start="3"><li>TaskTracker是运行在多个节点上的slaver服务。TaskTracker主动与JobTracker通信，接收作业，并负责直接执行每一个任务。</li></ol><p>TaskTracker都需要运行在HDFS的DataNode上.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h2&gt;&lt;p&gt;Hadoop MapReduce采用Master/Slave结构。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Master：是整个集群的唯一的全局管理
      
    
    </summary>
    
      <category term="Hadoop" scheme="http://yoursite.com/categories/Hadoop/"/>
    
    
      <category term="Hadoop" scheme="http://yoursite.com/tags/Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>Windows下的MapReduce编程实现</title>
    <link href="http://yoursite.com/2019/08/31/Windows%E4%B8%8B%E7%9A%84MapReduce%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0/"/>
    <id>http://yoursite.com/2019/08/31/Windows下的MapReduce编程实现/</id>
    <published>2019-08-31T02:12:44.000Z</published>
    <updated>2019-08-31T02:56:59.400Z</updated>
    
    <content type="html"><![CDATA[<h2 id="统计某银行信用卡违约用户数量"><a href="#统计某银行信用卡违约用户数量" class="headerlink" title="统计某银行信用卡违约用户数量"></a>统计某银行信用卡违约用户数量</h2><p><a href="https://github.com/PlutoaCharon/BankDefaulter_MapReduce/blob/master/UCI_Credit_Card.csv" target="_blank" rel="noopener">csv下载地址</a></p><p>违约规则：AY_1～PAY_6：PAY_1为2005年9月的还款情况；PAY_2为2005年8月的还款情况；…；PAY_6为2005年4月的还款情况。BILL_AMT1～BILL_AMT6和PAY_AMT1～PAY_AMT6中数字标识的含义也是如此。<br>PAY_1～PAY_6的取值含义为：0 = 及时还；1 = 还款延迟一个月；2 = 还款延迟两个月；3 = 还款延迟三个月；…；9 = 还款延迟九个月及以上。<br>每月的支付金额PAY_AMT不能低于银行规定的当月最低还款额，否则就是违约。如果支付金额PAY_AMT大于上月账单金额BILL_AMT则视为及时还，剩余金额存入信用卡留做下次消费；如果支付金额小于上月账单金额但高于最低还款额则视为延迟还款。</p><p>要求:</p><p>在Hadoop平台编程实现统计银行违约用户数量</p><p>实现:</p><p>porn.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>Hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>BankDefaulter_MapReduce<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-hdfs<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-mapreduce-client-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>au.com.bytecode<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>opencsv<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>bankfinddefaulter.FindDefaulter<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>FindDefaulter.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bankfinddefaulter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FindDefaulter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        Job job = <span class="keyword">new</span> Job();</span><br><span class="line">        job.setJarByClass(FindDefaulter.class);</span><br><span class="line"></span><br><span class="line">        FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(<span class="string">"hdfs://172.18.74.236:9000/input/UCI_Credit_Card.csv"</span>));  <span class="comment">// csv文件所在目录</span></span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(<span class="string">"hdfs://172.18.74.236:9000/out"</span>));                   <span class="comment">// 设置输出文件目录</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关联自定义的mapper和reducer</span></span><br><span class="line">        job.setMapperClass(BankMapper.class);</span><br><span class="line">        job.setReducerClass(BankReducer.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置map输入数据类型</span></span><br><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br><span class="line">        job.setMapOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置最终输出数据类型</span></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line">        System.exit(job.waitForCompletion(<span class="keyword">true</span>)?<span class="number">0</span>:<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BankReducer.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bankfinddefaulter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BankReducer</span> <span class="keyword">extends</span></span></span><br><span class="line"><span class="class">        <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values,</span></span></span><br><span class="line"><span class="function"><span class="params">                          Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (IntWritable value : values) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        context.write(key, <span class="keyword">new</span> IntWritable(count));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BankMapper.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bankfinddefaulter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> au.com.bytecode.opencsv.CSVParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BankMapper</span> <span class="keyword">extends</span></span></span><br><span class="line"><span class="class">        <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (key.get() &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">            String[] lines = <span class="keyword">new</span> CSVParser().parseLine(value.toString());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//选取csv文件中第25行数据进行统计</span></span><br><span class="line">            context.write(<span class="keyword">new</span> Text(lines[<span class="number">24</span>]), <span class="keyword">new</span> IntWritable(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h2><p>在IDEA中编写好业务代码,是用mvn将程序打成jar包,上传到hdoop平台之后运行</p><p>在IDEA下的Terminal控制台中输入</p><p><code>mvn clean package</code></p><p>此命令基于pom.xml中</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>bankfinddefaulter.FindDefaulter<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Hadoop平台运行jar包"><a href="#Hadoop平台运行jar包" class="headerlink" title="Hadoop平台运行jar包"></a>Hadoop平台运行jar包</h3><p>将项目代码打成jar包后,上传到hadoop平台,输入</p><p><code>hadoop jar Hadoop_API-1.0-SNAPSHOT-jar-with-dependencies.jar</code></p><p>其中1为违约用户数量, 共有6636位用户违约</p><h2 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h2><p>在IDEA中本地运行</p><p>在Windows设置好Hadoop开发环境后, 运行FindDefaulter.java</p><p>在<code>172.18.74.236:50070/output</code> 目录中下载查看输出</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;统计某银行信用卡违约用户数量&quot;&gt;&lt;a href=&quot;#统计某银行信用卡违约用户数量&quot; class=&quot;headerlink&quot; title=&quot;统计某银行信用卡违约用户数量&quot;&gt;&lt;/a&gt;统计某银行信用卡违约用户数量&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://githu
      
    
    </summary>
    
      <category term="Hadoop" scheme="http://yoursite.com/categories/Hadoop/"/>
    
    
      <category term="Hadoop" scheme="http://yoursite.com/tags/Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>Mysql（双主）主主架构配置</title>
    <link href="http://yoursite.com/2019/08/20/Mysql%EF%BC%88%E5%8F%8C%E4%B8%BB%EF%BC%89%E4%B8%BB%E4%B8%BB%E6%9E%B6%E6%9E%84%E9%85%8D%E7%BD%AE/"/>
    <id>http://yoursite.com/2019/08/20/Mysql（双主）主主架构配置/</id>
    <published>2019-08-20T12:22:20.000Z</published>
    <updated>2019-09-05T14:53:09.928Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本次搭建Mysql主主架构基于我的<a href="https://plutoacharon.github.io/2019/08/20/keepalived+nginx+apache+mysql%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8%E3%80%81%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E7%BD%91%E7%AB%99(%E4%B8%8A" target="_blank" rel="noopener">keepalived+nginx+apache+mysql实现高可用、负载均衡的网站</a>/#more)这篇文章</p><p>在搭建主主配置之前我们先介绍介绍mysql主从方案</p><p>mysql主从方案,有一主多从，读写分离等功能，但是单主存在单点故障，从库切换成主库需要作改动等缺点。</p><p>因此，如果是双主或者多主，就会增加mysql入口，增加高可用。</p><p>不过多主需要考虑自增长ID问题，这个需要特别设置配置文件，比如双主，可以使用奇偶，总之，主之间设置自增长ID相互不冲突就能完美解决自增长ID冲突问题。</p><p>MySQL双主（主主）架构方案思路是:</p><ol><li><p>两台mysql都可读写，互为主备，默认只使用一台（masterA）负责数据的写入，另一台（masterB）备用；</p></li><li><p>masterA是masterB的主库，masterB又是masterA的主库，它们互为主从；</p></li><li><p>两台主库之间做高可用,可以采用keepalived等方案（使用VIP对外提供服务）；</p></li><li><p>所有提供服务的从服务器与masterB进行主从同步（双主多从）;</p></li><li><p>建议采用高可用策略的时候，masterA或masterB均不因宕机恢复后而抢占VIP（非抢占模式）；</p></li></ol><p>这样做可以在一定程度上保证主库的高可用,在一台主库down掉之后,可以在极短的时间内切换到另一台主库上（尽可能减少主库宕机对业务造成的影响），减少了主从同步给线上主库带来的压力；</p><p>但是也有几个不足的地方:</p><ol><li><p>masterB可能会一直处于空闲状态（可以用它当从库，负责部分查询）；</p></li><li><p>主库后面提供服务的从库要等masterB先同步完了数据后才能去masterB上去同步数据，这样可能会造成一定程度的同步延时；</p></li></ol><h2 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h2><table><thead><tr><th>主机名称</th><th>安装软件</th><th>ip地址</th></tr></thead><tbody><tr><td>mysql1</td><td>mysql、mysql-server</td><td>172.18.74.76</td></tr><tr><td>mysql2</td><td>mysql、mysql-server</td><td>172.18.74.71</td></tr></tbody></table><h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><pre><code>wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpmmv http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm /etc/yum.repo/rpm -ivh mysql-community-release-el7-5.noarch.rpmyum install -y mysql&amp;&amp;yum install mysql-server -ysystemctl start mysql</code></pre><p><img src="1.png" alt="下"></p><p>首先我们配置mysql双主模型，让其数据同步</p><p><code>vim /etc.my.cnf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server-id=1</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">binlog_format=mixed</span><br><span class="line">relay-log=relay-bin</span><br><span class="line">relay-log-index=slave-relay-bin.index</span><br><span class="line">auto-increment-increment=2</span><br><span class="line">auto-increment-offset=1</span><br><span class="line">log-slave-updates</span><br></pre></td></tr></table></figure><p><img src="2.png" alt="下"></p><p>其中红框历史需要添加的内容</p><p>粉框中是两个mysql不同的地方</p><p>mysql2的粉框处是2</p><p>然后重启mysql</p><p><code>systemctl restart mysql</code></p><p>auto-increment 两行的配置，使 masterA字段产生的数值是 奇数1，3，5，7 下面的masterB 产生的是 2，4，6，8 等，这样会避开双主 id 重复的问题</p><h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><pre><code>grant replication slave on *.* to &apos;repl&apos;@&apos;172.18.74.71&apos; identified by &apos;123456&apos;; &apos;;flush privileges;</code></pre><p><img src="3.png" alt="下"></p><h2 id="web服务器授权"><a href="#web服务器授权" class="headerlink" title="web服务器授权"></a>web服务器授权</h2><pre><code>mysql&gt; create database db_jd;Query OK, 1 row affected (0.00 sec)mysql&gt; create user web@localhost identified by &apos;123456&apos;;Query OK, 0 rows affected (0.00 sec)mysql&gt; grant all privileges on *.* to web@localhost;Query OK, 0 rows affected (0.00 sec)mysql&gt; create user web@172.18.74.66 identified by &apos;123456&apos;;Query OK, 0 rows affected (0.00 sec)mysql&gt; create user web@172.18.74.69 identified by &apos;123456&apos;;Query OK, 0 rows affected (0.00 sec)mysql&gt; GRANT ALL PRIVILEGES ON *.* TO &apos;web&apos;@&apos;%&apos; IDENTIFIED BY &apos;123456&apos; WITH GRANT OPTTION;--------------GRANT ALL PRIVILEGES ON *.* TO &apos;web&apos;@&apos;%&apos; IDENTIFIED BY &apos;123456&apos; WITH GRANT OPTION--------------Query OK, 0 rows affected (0.00 sec)mysql&gt; flush privileges;Query OK, 0 rows affected (0.01 sec)</code></pre><h2 id="查看主库的状态"><a href="#查看主库的状态" class="headerlink" title="查看主库的状态"></a>查看主库的状态</h2><p><img src="5.png" alt="Mysql"></p><p><img src="7.png" alt="Mysql"></p><h2 id="配置同步信息"><a href="#配置同步信息" class="headerlink" title="配置同步信息"></a>配置同步信息</h2><p>masterA上：</p><pre><code>change master to master_host=&apos;172.18.74.71&apos;,master_port=3306,master_user=&apos;repl&apos;,master_password=&apos;123456&apos;,master_log_file=&apos;mysql-bin.000002&apos;,master_log_pos=632;start slave;show slave status\G</code></pre><p><img src="9.png" alt="Mysql"></p><p>masterB上：</p><pre><code>change master to master_host=&apos;172.18.74.76&apos;,master_port=3306,master_user=&apos;repl&apos;,master_password=&apos;123456&apos;,master_log_file=&apos;mysql-bin.000002&apos;,master_log_pos=632;start slave;show slave status\G</code></pre><p><img src="8.png" alt="Mysql"></p><h2 id="测试主主同步"><a href="#测试主主同步" class="headerlink" title="测试主主同步"></a>测试主主同步</h2><p>在masterA上创建一个数据库测试同步效果</p><pre><code>mysql&gt; create database myTest;Query OK, 1 row affected (0.00 sec)mysql&gt; show databases;+--------------------+| Database           |+--------------------+| information_schema || myTest             || mysql              || performance_schema |+--------------------+4 rows in set (0.00 sec)</code></pre><p>到masterB查看是否已经同步创建数据库</p><pre><code>mysql&gt; show databases;+--------------------+| Database           |+--------------------+| information_schema || myTest             || mysql              || performance_schema |+--------------------+4 rows in set (0.00 sec)</code></pre><p>成功!</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;本次搭建Mysql主主架构基于我的&lt;a href=&quot;https://plutoacharon.github.io/2019/08/20/ke
      
    
    </summary>
    
      <category term="高可用负载均衡" scheme="http://yoursite.com/categories/%E9%AB%98%E5%8F%AF%E7%94%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
    
    
      <category term="高可用负载均衡" scheme="http://yoursite.com/tags/%E9%AB%98%E5%8F%AF%E7%94%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
    
  </entry>
  
  <entry>
    <title>Centos7 防火墙关闭与nginx无法访问</title>
    <link href="http://yoursite.com/2019/08/20/Centos7-%E9%98%B2%E7%81%AB%E5%A2%99%E5%85%B3%E9%97%AD%E4%B8%8Enginx%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE/"/>
    <id>http://yoursite.com/2019/08/20/Centos7-防火墙关闭与nginx无法访问/</id>
    <published>2019-08-20T12:02:59.000Z</published>
    <updated>2019-08-20T12:09:10.212Z</updated>
    
    <content type="html"><![CDATA[<p>默认情况下，Centos7防火墙是打开的，如果你没有关闭他，你安装nginx后启动，是无法访问到nginx服务的。</p><p>所以需要做这件事</p><h2 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h2><p>启动前先看它启动没有，通过linux命令查看所有端口，看看有没有80</p><p>netstat -ntlp</p><p>如果没有，则通过命令启动</p><p><code>sudo systemctl start nginx.service</code></p><h2 id="设置nginx开启启动"><a href="#设置nginx开启启动" class="headerlink" title="设置nginx开启启动"></a>设置nginx开启启动</h2><p><code>sudo chkconfig nginx on</code></p><h2 id="关闭Centos自带的firewall防火墙"><a href="#关闭Centos自带的firewall防火墙" class="headerlink" title="关闭Centos自带的firewall防火墙"></a>关闭Centos自带的firewall防火墙</h2><p><code>systemctl stop firewalld.service</code> #停止firewall</p><h2 id="禁止Firewall下次启动"><a href="#禁止Firewall下次启动" class="headerlink" title="禁止Firewall下次启动"></a>禁止Firewall下次启动</h2><p><code>systemctl disable firewalld.service #禁止firewall开机启动</code></p><p><img src="1.png" alt="Nginx"></p><p><img src="2.png" alt="Nginx"></p><p><img src="3.png" alt="Nginx"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;默认情况下，Centos7防火墙是打开的，如果你没有关闭他，你安装nginx后启动，是无法访问到nginx服务的。&lt;/p&gt;
&lt;p&gt;所以需要做这件事&lt;/p&gt;
&lt;h2 id=&quot;启动nginx&quot;&gt;&lt;a href=&quot;#启动nginx&quot; class=&quot;headerlink&quot; titl
      
    
    </summary>
    
      <category term="Liunx" scheme="http://yoursite.com/categories/Liunx/"/>
    
    
      <category term="Liunx" scheme="http://yoursite.com/tags/Liunx/"/>
    
      <category term="高可用负载均衡" scheme="http://yoursite.com/tags/%E9%AB%98%E5%8F%AF%E7%94%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
    
  </entry>
  
  <entry>
    <title>Linux下进程kill掉的N种方法</title>
    <link href="http://yoursite.com/2019/08/20/Linux%E4%B8%8B%E8%BF%9B%E7%A8%8Bkill%E6%8E%89%E7%9A%84N%E7%A7%8D%E6%96%B9%E6%B3%95/"/>
    <id>http://yoursite.com/2019/08/20/Linux下进程kill掉的N种方法/</id>
    <published>2019-08-20T12:02:44.000Z</published>
    <updated>2019-08-31T02:45:28.419Z</updated>
    
    <content type="html"><![CDATA[<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>我在Liunx安装Apache服务时，遇到</p><p><img src="image001.png" alt="Liunx"></p><p>有进程存在，本进程原地等待</p><p>导致此状况原因可能是我一开始没有联网直接运行</p><p><code>yum install -y httpd</code></p><p>导致该进程一直<strong>占用资源，pid被锁定</strong></p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><h3 id="常规篇"><a href="#常规篇" class="headerlink" title="常规篇"></a>常规篇</h3><p>首先，用ps查看进程，方法如下：</p><p><img src="image003.png" alt="Liunx"></p><p><code>ps -ef</code>查看详情</p><p><img src="image005.png" alt="Liunx"></p><p>此时如果我想杀了yum的进程就在终端输入：</p><p><code>kill -s 9 2457</code></p><p>其中-s 9 制定了传递给进程的信号是９，即强制、尽快终止进程。</p><p>2457则是上面ps查到的yum的PID</p><p><img src="image007.png" alt="Liunx"></p><p>杀死其他yum进程后，yum便能正常运行</p><p><img src="image009.png" alt="Liunx"></p><h3 id="进阶篇"><a href="#进阶篇" class="headerlink" title="进阶篇"></a>进阶篇</h3><p>把ps的查询结果通过管道给grep查找包含特定字符串的进程。管道符“|”用来隔开两个命令，管道符左边命令的输出会作为管道符右边命令的输入。</p><p><code>ps -ef | grep yum</code></p><p>这样可以更加简洁的看到yum进程的信息</p><p><img src="image011.png" alt="Liunx"></p><p><strong>使用pgrep：</strong></p><p>pgrep的p表明了这个命令是专门用于进程查询的grep。</p><p><code>pgrep yum</code></p><p><img src="image013.png" alt="Liunx"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;原因&quot;&gt;&lt;a href=&quot;#原因&quot; class=&quot;headerlink&quot; title=&quot;原因&quot;&gt;&lt;/a&gt;原因&lt;/h2&gt;&lt;p&gt;我在Liunx安装Apache服务时，遇到&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;image001.png&quot; alt=&quot;Liunx&quot;&gt;&lt;/p&gt;

      
    
    </summary>
    
      <category term="Liunx" scheme="http://yoursite.com/categories/Liunx/"/>
    
    
      <category term="Liunx" scheme="http://yoursite.com/tags/Liunx/"/>
    
  </entry>
  
  <entry>
    <title>Centos7 安装 php 和 php-fpm</title>
    <link href="http://yoursite.com/2019/08/20/Centos7-%E5%AE%89%E8%A3%85-php-%E5%92%8C-php-fpm/"/>
    <id>http://yoursite.com/2019/08/20/Centos7-安装-php-和-php-fpm/</id>
    <published>2019-08-20T11:53:53.000Z</published>
    <updated>2019-08-20T12:09:06.627Z</updated>
    
    <content type="html"><![CDATA[<h1 id="安装-php-和-php-fpm"><a href="#安装-php-和-php-fpm" class="headerlink" title="安装 php 和 php-fpm"></a>安装 php 和 php-fpm</h1><h2 id="首先安装epel"><a href="#首先安装epel" class="headerlink" title="首先安装epel"></a>首先安装epel</h2><p><code>yum -y install epel-release</code></p><h2 id="安装php-php-fpm"><a href="#安装php-php-fpm" class="headerlink" title="安装php php-fpm"></a>安装php php-fpm</h2><p><code>yum -y install php php-fpm</code></p><h2 id="查看php版本"><a href="#查看php版本" class="headerlink" title="查看php版本"></a>查看php版本</h2><p><code>php -v</code></p><h2 id="安装php-mysql"><a href="#安装php-mysql" class="headerlink" title="安装php-mysql"></a>安装php-mysql</h2><p><code>yum install php-mysql</code></p><h2 id="设置php-fpm开机自动启动"><a href="#设置php-fpm开机自动启动" class="headerlink" title="设置php-fpm开机自动启动"></a>设置php-fpm开机自动启动</h2><p><code>systemctl enable php-fpm</code></p><h2 id="启动php-fpm"><a href="#启动php-fpm" class="headerlink" title="启动php-fpm"></a>启动php-fpm</h2><p><code>systemctl start php-fpm</code></p><h2 id="重启httpd服务"><a href="#重启httpd服务" class="headerlink" title="重启httpd服务"></a>重启httpd服务</h2><p><code>systemctl restart httpd.service</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;安装-php-和-php-fpm&quot;&gt;&lt;a href=&quot;#安装-php-和-php-fpm&quot; class=&quot;headerlink&quot; title=&quot;安装 php 和 php-fpm&quot;&gt;&lt;/a&gt;安装 php 和 php-fpm&lt;/h1&gt;&lt;h2 id=&quot;首先安装epel&quot;
      
    
    </summary>
    
      <category term="Liunx" scheme="http://yoursite.com/categories/Liunx/"/>
    
    
      <category term="Liunx" scheme="http://yoursite.com/tags/Liunx/"/>
    
  </entry>
  
  <entry>
    <title>keepalived+nginx+apache+mysql实现高可用、负载均衡的网站(下)</title>
    <link href="http://yoursite.com/2019/08/20/keepalived-nginx-apache-mysql%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8%E3%80%81%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E7%BD%91%E7%AB%99-%E4%B8%8B/"/>
    <id>http://yoursite.com/2019/08/20/keepalived-nginx-apache-mysql实现高可用、负载均衡的网站-下/</id>
    <published>2019-08-20T11:52:45.000Z</published>
    <updated>2019-08-31T02:33:56.712Z</updated>
    
    <content type="html"><![CDATA[<h2 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h2><table><thead><tr><th>主机名称</th><th>安装软件</th><th>ip地址</th></tr></thead><tbody><tr><td>nginx_mysql_m</td><td>keepalived+nginx</td><td>172.18.74.77</td></tr><tr><td>nginx_mysql_s</td><td>keepalived+nginx</td><td>172.18.74.70</td></tr><tr><td>mysql1</td><td>mysql、mysql-server</td><td>172.18.74.76</td></tr><tr><td>mysql2</td><td>mysql、mysql-server</td><td>172.18.74.71</td></tr></tbody></table><h2 id="keepalived配置"><a href="#keepalived配置" class="headerlink" title="keepalived配置"></a>keepalived配置</h2><p>keepalived的配置和上一篇的类似,也是主从配置</p><p>在nginx_mysql_m中keeplived配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">       1070481109@qq.com      #这里是故障会给谁发邮件</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">   smtp_server 127.0.0.1     #邮件服务器的地址</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id xu_ka_web_m     #路由的id 一般写主机名</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   #vrrp_strict</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script chk_nginx &#123; </span><br><span class="line">script "/etc/keepalived/nginx_check.sh" # 检查nginx状态的脚本</span><br><span class="line">interval 2</span><br><span class="line">weight 3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;            #vrrp实例定义部分</span><br><span class="line">    state MASTER                #设置lvs的状态，MASTER和BACKUP两种，必须大写</span><br><span class="line">    interface ens160             #设置对外服务的接口</span><br><span class="line">    virtual_router_id 51       #设置虚拟路由标示，这个标示是一个数字，同一个vrrp实例使用唯一标示</span><br><span class="line">    priority 100               #定义优先级，数字越大优先级越高，在一个vrrp——instance下，master的优先级必须大于backup</span><br><span class="line">    advert_int 1              #设定master与backup负载均衡器之间同步检查的时间间隔，单位是秒</span><br><span class="line">    authentication &#123;           #设置验证类型和密码</span><br><span class="line">        auth_type PASS         #主要有PASS和AH两种</span><br><span class="line">        auth_pass 1111         #验证密码，同一个vrrp_instance下MASTER和BACKUP密码必须相同</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;         #设置虚拟ip地址，可以设置多个，每行一个</span><br><span class="line">        172.18.74.182</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123; ## 将 track_script 块加入 instance 配置块</span><br><span class="line">        chk_nginx</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 172.18.74.182 80 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind NAT</span><br><span class="line">    persistence_timeout 50</span><br><span class="line">    protocol TCP</span><br><span class="line"> </span><br><span class="line">    real_server 172.18.74.64 80 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        TCP_CHECK&#123;</span><br><span class="line">            connect_timeout 3</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在nginx_mysql_s中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">    notification_email &#123;</span><br><span class="line">    root@localhost</span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from keepalived@localhost</span><br><span class="line">    smtp_server 127.0.0.1</span><br><span class="line">    smtp_connect_timeout 30</span><br><span class="line">    router_id nginx_mysql_s</span><br><span class="line">    vrrp_skip_check_adv_addr</span><br><span class="line">    #vrrp_strict</span><br><span class="line">    vrrp_garp_interval 0</span><br><span class="line">    vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line">    script &quot;/etc/keepalived/nginx_check.sh&quot; # 检查nginx状态的脚本</span><br><span class="line">    interval 2</span><br><span class="line">    weight 3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface ens160</span><br><span class="line">    virtual_router_id 66</span><br><span class="line">    priority 90                    #backup这里要比100小</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.18.74.183</span><br><span class="line">&#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        chk_nginx</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="nginx的配置"><a href="#nginx的配置" class="headerlink" title="nginx的配置"></a>nginx的配置</h2><p>因为这里nginx监听的是3306的端口，不需要web服务所以配置文件较简单，但是需要用到stream模块</p><p>在配置的时候需要添加上–with–stream</p><p><code>./configure --add-module=../ngx_cache_purge-2.3 --prefix=/usr/local/nginx --with-http_ssl_module --with-stream --with-pcre=../pcre-8.41 --with-zlib=../zlib-1.2.11 --with-openssl=../openssl-1.0.2o</code></p><p>其他和上一篇的安装方法一样</p><h3 id="修改nginx配置文件"><a href="#修改nginx配置文件" class="headerlink" title="修改nginx配置文件"></a>修改nginx配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">stream &#123;</span><br><span class="line">upstream mysql &#123;</span><br><span class="line"></span><br><span class="line">            server 172.18.74.76:3306 weight=5 max_fails=3 fail_timeout=30s;</span><br><span class="line">            server 172.18.74.71:3306 weight=5 max_fails=3 fail_timeout=30s;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line"></span><br><span class="line">            listen 3306;</span><br><span class="line">            proxy_connect_timeout 1s;</span><br><span class="line">            proxy_timeout 3s;</span><br><span class="line">            proxy_pass mysql;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h3><p><code>/usr/local/nginx/sbin/nginx</code></p><p><code>netstat -napt</code></p><p><img src="3.png" alt="下"></p><p>发现nginx已经被成功监听</p><p>backup的nginx配置相同</p><h3 id="mysql数据库配置"><a href="#mysql数据库配置" class="headerlink" title="mysql数据库配置"></a>mysql数据库配置</h3><p><a href="https://plutoacharon.github.io/2019/08/20/Mysql%EF%BC%88%E5%8F%8C%E4%B8%BB%EF%BC%89%E4%B8%BB%E4%B8%BB%E6%9E%B6%E6%9E%84%E9%85%8D%E7%BD%AE/#more" target="_blank" rel="noopener">Mysql主主配置</a></p><p>具体可以参考我的这篇文章</p><h2 id="基于web页面的测试"><a href="#基于web页面的测试" class="headerlink" title="基于web页面的测试"></a>基于web页面的测试</h2><p><code>cd /var/www/html</code></p><p><code>vim con.php</code></p><p>如果系统中没有php环境可以参考我的这篇文章<a href="https://plutoacharon.github.io/2019/08/20/Centos7-%E5%AE%89%E8%A3%85-php-%E5%92%8C-php-fpm/#more" target="_blank" rel="noopener">php环境搭建</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$servername = <span class="string">"172.18.74.76"</span>;</span><br><span class="line">$username = <span class="string">"web"</span>;</span><br><span class="line">$password = <span class="string">"123456"</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 创建连接</span></span><br><span class="line">$conn = <span class="keyword">new</span> mysqli($servername, $username, $password);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 检测连接</span></span><br><span class="line"><span class="keyword">if</span> ($conn-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"连接失败: "</span> . $conn-&gt;connect_error);</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">"连接成功"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>浏览器访问web的ip/con.php</p><p><img src="2.png" alt="下"></p><p>mysql2同理</p><p>然后在数据库db_jd里创建表,为接下来的实验做好准备</p><p><code>mysql &gt; create table tb_goods (tltle VarChar(40), price Decimal(10), market_price Decimal(10));</code></p><p>在web服务器编写接口程序连接mysql，并写一个能插入数据到数据库的表单</p><p><code>vim coon.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//1、连接数据库</span></span><br><span class="line">    mysql_connect(<span class="string">'172.18.74.76'</span>,<span class="string">'web'</span>,<span class="string">'123456'</span>);</span><br><span class="line">    <span class="comment">//2、选择数据库</span></span><br><span class="line">    mysql_select_db(<span class="string">'db_jd'</span>);</span><br><span class="line">    <span class="comment">//3、指定数据库的编码格式</span></span><br><span class="line">    mysql_query(<span class="string">'set names utf8'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>vim index.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html;charset=UTF-8"</span> /&gt;</span><br><span class="line">    &lt;title&gt;产品添加-JD产品管理系统&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h3&gt;JD产品管理&lt;/h3&gt;</span><br><span class="line">    &lt;form action=<span class="string">"deal.php"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">        图书名称：&lt;input type=<span class="string">'text'</span> name=<span class="string">'title'</span> /&gt;</span><br><span class="line">        &lt;hr /&gt;</span><br><span class="line">        销售价格：&lt;input type=<span class="string">"text"</span> name=<span class="string">'price'</span> /&gt;</span><br><span class="line">        &lt;hr /&gt;</span><br><span class="line">        市场价格：&lt;input type=<span class="string">"text"</span> name=<span class="string">'market_price'</span> /&gt;</span><br><span class="line">        &lt;hr /&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> name=<span class="string">"submit"</span> value=<span class="string">"添加"</span> /&gt;</span><br><span class="line">        &lt;input type=<span class="string">"reset"</span> name=<span class="string">"reset"</span> value=<span class="string">"重置"</span> /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><code>vim deal.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//1、设置响应头信息</span></span><br><span class="line">    header(<span class="string">'Content-type:text/html; charset=utf-8'</span>);</span><br><span class="line">    <span class="comment">//2、submit安全判断</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">        <span class="comment">//3、接收数据</span></span><br><span class="line">        $title = $_POST[<span class="string">'title'</span>];</span><br><span class="line">        $price = $_POST[<span class="string">'price'</span>];</span><br><span class="line">        $market_price = $_POST[<span class="string">'market_price'</span>];</span><br><span class="line">        <span class="keyword">include</span> <span class="string">'coon.php'</span>;</span><br><span class="line">        <span class="comment">//9、定义SQL语句</span></span><br><span class="line">        $sql = <span class="string">"insert into tb_goods values ('$title','$price','$market_price')"</span>;</span><br><span class="line">        <span class="comment">//10、执行SQL语句</span></span><br><span class="line">        $result = mysql_query($sql);</span><br><span class="line">        <span class="keyword">if</span>($result) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'添加成功'</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'添加失败'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="访问webvip的地址"><a href="#访问webvip的地址" class="headerlink" title="访问webvip的地址"></a>访问webvip的地址</h2><p>插入数据</p><p><img src="4.png" alt="下"></p><h2 id><a href="#" class="headerlink" title></a><img src="10.png" alt="下"></h2><p>报错指南:</p><p><img src="5.png" alt="下"></p><p>原因： SELinux 不让 httpd 访问外网</p><p>在本地可以连接成功但是外网访问不了</p><p><code>getsebool -a | grep httpd</code></p><p>发现 <code>httpd_can_network_connect --&gt; off</code></p><p><code>setsebool httpd_can_network_connect 1</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;环境介绍&quot;&gt;&lt;a href=&quot;#环境介绍&quot; class=&quot;headerlink&quot; title=&quot;环境介绍&quot;&gt;&lt;/a&gt;环境介绍&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;主机名称&lt;/th&gt;
&lt;th&gt;安装软件&lt;/th&gt;
&lt;th&gt;ip地址&lt;/th&gt;
&lt;/
      
    
    </summary>
    
      <category term="高可用负载均衡" scheme="http://yoursite.com/categories/%E9%AB%98%E5%8F%AF%E7%94%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
    
    
      <category term="高可用负载均衡" scheme="http://yoursite.com/tags/%E9%AB%98%E5%8F%AF%E7%94%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
    
  </entry>
  
  <entry>
    <title>keepalived+nginx+apache+mysql实现高可用、负载均衡的网站(上)</title>
    <link href="http://yoursite.com/2019/08/20/keepalived+nginx+apache+mysql%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8%E3%80%81%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E7%BD%91%E7%AB%99(%E4%B8%8A)/"/>
    <id>http://yoursite.com/2019/08/20/keepalived+nginx+apache+mysql实现高可用、负载均衡的网站(上)/</id>
    <published>2019-08-20T11:52:34.000Z</published>
    <updated>2019-08-26T14:49:53.091Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>说明：本次实验是需要8台虚拟机的项目 其架构如下图：</p></blockquote><p><img src="1.png" alt="上"></p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>keepalived是一个类似于layer3, 4 &amp; 5交换机制的软件，也就是我们平时说的第3层、第4层和第5层交换。Keepalived是自动完成，不需人工干涉。</p><p>Layer3,4,5工作在IP/TCP协议栈的IP层，TCP层，及应用层,原理分别如下：</p><p>Layer3：Keepalived使用Layer3的方式工作式时，Keepalived会定期向服务器群中的服务器发送一个ICMP的数据包（既我们平时用的Ping程序）,如果发现某台服务的IP地址没有激活，Keepalived便报告这台服务器失效，并将它从服务器群中剔除，这种情况的典型例子是某台服务器被非法关机。Layer3的方式是以服务器的IP地址是否有效作为服务器工作正常与<br>否的标准。</p><p>Layer4:如果理解了Layer3的方式，Layer4就容易了。Layer4主要以TCP端口的状态来决定服务器工作正常与否。如web server的服务端口一般是80，如果Keepalived检测到80端口没有启动，则Keepalived将把这台服务器从服务器群中剔除。</p><p>Layer5：Layer5对指定的URL执行HTTP GET。然后使用MD5算法对HTTP GET结果进行求和。如果这个总数与预期值不符，那么测试是错误的，服务器将从服务器池中移除。该模块对同一服务实施多URL获取检查。如果您使用承载多个应用程序服务器的服务器，则此功能很有用。此功能使您能够检查应用程序服务器是否正常工作。MD5摘要是使用genhash实用程序（包含在keepalived软件包中）生成的。</p><p>Nginx作为负载均衡服务：Nginx 既可以在内部直接支持 Rails 和 PHP 程序对外进行服务，也可以支持作为 HTTP代理服务对外进行服务。Nginx采用C进行编写，是一款高性能的反向代理服务器。</p><h2 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h2><p>虚拟机数量：四台</p><p>操作系统：全部是centos7.3</p><p>keepalived版本：keepalived-2.0.7</p><p>nginx版本：nginx-1.14.0</p><table><thead><tr><th>主机名称</th><th>安装软件</th><th>ip地址</th></tr></thead><tbody><tr><td>keepalived_web_m</td><td>keepalived+nginx</td><td>172.18.74.64</td></tr><tr><td>keepalived_web_s</td><td>keepalived+nginx</td><td>172.18.74.65</td></tr><tr><td>web1</td><td>Apache</td><td>172.18.74.66</td></tr><tr><td>web2</td><td>Apache</td><td>172.18.74.69</td></tr></tbody></table><h2 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a>环境安装</h2><p>首先关闭所有机器的防火墙和selinux，配置好之后我们开启，然后添加策略。</p><pre><code>systemctl stop firewalldsetenforce 0</code></pre><h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><p>首先下载并解压需要的包</p><pre><code>wget http://www.zlib.net/zlib-1.2.11.tar.gztar -zxvf zlib-1.2.11.tar.gzwget https://jaist.dl.sourceforge.net/project/pcre/pcre/8.41/pcre-8.41.tar.gztar -zxvf pcre-8.41.tar.gzwget https://www.openssl.org/source/openssl-1.0.2o.tar.gztar -zxvf openssl-1.0.2o.tar.gzwget http://labs.frickle.com/files/ngx_cache_purge-2.3.tar.gztar -zxvf ngx_cache_purge-2.3.tar.gzwget http://nginx.org/download/nginx-1.14.0.tar.gztar -zxvf nginx-1.14.0.tar.gz</code></pre><p>进入nginx目录</p><p><code>cd nginx-1.14.0</code></p><h4 id="配置安装选项"><a href="#配置安装选项" class="headerlink" title="配置安装选项"></a>配置安装选项</h4><pre><code>./configure --add-module=../ngx_cache_purge-2.3 --prefix=/usr/local/nginx --with-http_ssl_module --with-stream --with-pcre=../pcre-8.41 --with-zlib=../zlib-1.2.11 --with-openssl=../openssl-1.0.2o</code></pre><p>通过<code>/usr/local/nginx</code>配置项可以知道主要生效配置文件在此文件夹中</p><p>编译并安装</p><p><code>make&amp;&amp;make install</code></p><p>先备份一份nginx配置文件</p><pre><code>cd /usr/local/nginx/confcp nginx.conf ./nginx.conf.bak</code></pre><p>修改nginx.conf的配置</p><p><code>vim nginx.conf</code></p><p>修改红框里的内容</p><p><img src="2.png" alt="上"></p><p>保存退出，然后在sbin目录重新加载nginx</p><p><code>./nginx -s reload</code></p><h3 id="下载并安装keepalived"><a href="#下载并安装keepalived" class="headerlink" title="下载并安装keepalived"></a>下载并安装keepalived</h3><pre><code>yum install wget make gcc gcc-c++ openssl-devel wget http://www.keepalived.org/software/keepalived-2.0.7.tar.gz tar zxvf keepalived-2.0.7.tar.gz cd keepalived-2.0.7 ./configure --prefix=/data/keepalived</code></pre><p>如果报以下警告：</p><pre><code>WARNING - this build will not support IPVS with IPv6. Please install libnl/libnl-3 dev libraries to support IPv6 with IPVS.</code></pre><p>不用担心，我们只需要用到VRRP功能，不需要用IPVS功能，所以请确保以下三项是yes就行了。</p><p><img src="3.png" alt="上"></p><h4 id="编译并安装"><a href="#编译并安装" class="headerlink" title="编译并安装"></a>编译并安装</h4><p><code>make&amp;&amp;make install</code></p><h4 id="将keepalived-以服务方式启动"><a href="#将keepalived-以服务方式启动" class="headerlink" title="将keepalived 以服务方式启动"></a>将keepalived 以服务方式启动</h4><p>创建/etc/keepalived目录并把keepalived的配置文件拷贝/etc/keepalived目录下并加入到开机启动。</p><pre><code>mkdir /etc/keepalived cp /data/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/ \systemctl enable keepalived</code></pre><h4 id="修改keepalived配置文件"><a href="#修改keepalived配置文件" class="headerlink" title="修改keepalived配置文件"></a>修改keepalived配置文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">       1070481109@qq.com      #这里是故障会给谁发邮件</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">   smtp_server 127.0.0.1     #邮件服务器的地址</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id xu_ka_web_m     #路由的id 一般写主机名</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   #vrrp_strict</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line">script "/etc/keepalived/nginx_check.sh" # 检查nginx状态的脚本</span><br><span class="line">interval 2</span><br><span class="line">weight 3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;            #vrrp实例定义部分</span><br><span class="line">    state MASTER                #设置lvs的状态，MASTER和BACKUP两种，必须大写</span><br><span class="line">    interface ens160             #设置对外服务的接口</span><br><span class="line">    virtual_router_id 51       #设置虚拟路由标示，这个标示是一个数字，同一个vrrp实例使用唯一标示</span><br><span class="line">    priority 100               #定义优先级，数字越大优先级越高，在一个vrrp——instance下，master的优先级必须大于backup</span><br><span class="line">    advert_int 1              #设定master与backup负载均衡器之间同步检查的时间间隔，单位是秒</span><br><span class="line">    authentication &#123;           #设置验证类型和密码</span><br><span class="line">        auth_type PASS         #主要有PASS和AH两种</span><br><span class="line">        auth_pass 1111         #验证密码，同一个vrrp_instance下MASTER和BACKUP密码必须相同</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;         #设置虚拟ip地址，可以设置多个，每行一个</span><br><span class="line">        172.18.74.182</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123; ## 将 track_script 块加入 instance 配置块</span><br><span class="line">        chk_nginx</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 172.18.74.182 80 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind NAT</span><br><span class="line">    persistence_timeout 50</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 172.18.74.64 80 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        TCP_CHECK&#123;</span><br><span class="line">            connect_timeout 3</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>备主机里的keepalived配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">       1070481109@qq.com      #这里是故障会给谁发邮件</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">   smtp_server 127.0.0.1     #邮件服务器的地址</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id xu_ka_web_s     #路由的id 一般写主机名</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   #vrrp_strict</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script chk_nginx &#123; </span><br><span class="line">script &quot;/etc/keepalived/nginx_check.sh&quot; # 检查nginx状态的脚本</span><br><span class="line">interval 2</span><br><span class="line">weight 3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;            #vrrp实例定义部分</span><br><span class="line">    state BACKUP                #设置lvs的状态，MASTER和BACKUP两种，必须大写</span><br><span class="line">    interface ens160             #设置对外服务的接口</span><br><span class="line">    virtual_router_id 51       #设置虚拟路由标示，这个标示是一个数字，同一个vrrp实例使用唯一标示</span><br><span class="line">    priority 90               #定义优先级，数字越大优先级越高，在一个vrrp——instance下，master的优先级必须大于backup</span><br><span class="line">    advert_int 1              #设定master与backup负载均衡器之间同步检查的时间间隔，单位是秒</span><br><span class="line">    authentication &#123;           #设置验证类型和密码</span><br><span class="line">        auth_type PASS         #主要有PASS和AH两种</span><br><span class="line">        auth_pass 1111         #验证密码，同一个vrrp_instance下MASTER和BACKUP密码必须相同</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;         #设置虚拟ip地址，可以设置多个，每行一个</span><br><span class="line">        172.18.74.182</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123; ## 将 track_script 块加入 instance 配置块</span><br><span class="line">        chk_nginx</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">virtual_server 172.18.74.182 80 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind NAT</span><br><span class="line">    persistence_timeout 50</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 172.18.74.65 80 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        TCP_CHECK&#123;</span><br><span class="line">            connect_timeout 3</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="添加检查nginx状态的脚本"><a href="#添加检查nginx状态的脚本" class="headerlink" title="添加检查nginx状态的脚本"></a>添加检查nginx状态的脚本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line">A=`ps -C nginx –no-header |wc -l`</span><br><span class="line">if [ $A -eq 0 ];then</span><br><span class="line">    /usr/local/nginx/sbin/nginx</span><br><span class="line">    sleep 2</span><br><span class="line">    if [ `ps -C nginx --no-header |wc -l` -eq 0 ];then</span><br><span class="line">        killall keepalived</span><br><span class="line">    fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h4 id="重启keepalived"><a href="#重启keepalived" class="headerlink" title="重启keepalived"></a>重启keepalived</h4><p><code>systemctl restart keepalived</code></p><p>输入命令<code>ip a</code>查看是否有vip</p><p><img src="4.png" alt="上"></p><p>keepalived+nginx+apache+mysql实现高可用、负载均衡的网站</p><p>然后关闭master的keepalived</p><p>systemctl stop keepalived</p><p>查看backup上是否有vip</p><p><img src="5.png" alt="上"></p><p>有说明配置成功</p><p>没有说明keepalived.conf存在问题</p><h4 id="安装apache服务器"><a href="#安装apache服务器" class="headerlink" title="安装apache服务器"></a>安装apache服务器</h4><p>在两台web服务器上安装apache服务</p><p><code>yum install -y httpd</code></p><p>打开服务</p><p><code>systemctl start httpd</code></p><p>编辑默认页面</p><p><code>cd /var/www/html/</code></p><p><code>vim index.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=UTF-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>产品添加-JD产品管理系统<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>JD产品管理<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"deal.php"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">图书名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'text'</span> <span class="attr">name</span>=<span class="string">'title'</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">销售价格：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">'price'</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">市场价格：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">'market_price'</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"添加"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"reset"</span> <span class="attr">name</span>=<span class="string">"reset"</span> <span class="attr">value</span>=<span class="string">"重置"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>同样在web2里安装apache并修改index.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=UTF-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>产品添加-JD产品管理系统<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>web2_JD产品管理<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"deal.php"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">图书名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'text'</span> <span class="attr">name</span>=<span class="string">'title'</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">销售价格：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">'price'</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">市场价格：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">'market_price'</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"添加"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"reset"</span> <span class="attr">name</span>=<span class="string">"reset"</span> <span class="attr">value</span>=<span class="string">"重置"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>通过浏览器访问vip</p><p>可以看到web1的页面，再次刷新会出现web2的页面</p><p><img src="6.png" alt="上"></p><p><img src="7.png" alt="上"></p><p>因为在nginx的配置为你教案中设置的web1和web2的权重为100：80</p><p>所以每访问180次会出现100次web1，80次web2</p><p><a href="https://plutoacharon.github.io/2019/08/20/keepalived-nginx-apache-mysql%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8%E3%80%81%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E7%BD%91%E7%AB%99-%E4%B8%8B/#more" target="_blank" rel="noopener">keepalived+nginx+apache+mysql实现高可用、负载均衡的网站-下</a></p><hr><p>报错指南:</p><p><img src="8.png" alt="上"></p><p><img src="9.png" alt="上"></p><p>原因</p><p>未使用nginx -c的参数指定nginx.conf文件的位置</p><p>解决</p><p><code>/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</code> 执行</p><hr><p><img src="11.png" alt="上"></p><p><img src="10.png" alt="上"></p><p>不能加空格</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;说明：本次实验是需要8台虚拟机的项目 其架构如下图：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;1.png&quot; alt=&quot;上&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; t
      
    
    </summary>
    
      <category term="高可用负载均衡" scheme="http://yoursite.com/categories/%E9%AB%98%E5%8F%AF%E7%94%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
    
    
      <category term="高可用负载均衡" scheme="http://yoursite.com/tags/%E9%AB%98%E5%8F%AF%E7%94%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
    
  </entry>
  
  <entry>
    <title>IDEA使用Git将项目上传到Github</title>
    <link href="http://yoursite.com/2019/08/17/IDEA%E4%BD%BF%E7%94%A8Git%E5%B0%86%E9%A1%B9%E7%9B%AE%E4%B8%8A%E4%BC%A0%E5%88%B0Github/"/>
    <id>http://yoursite.com/2019/08/17/IDEA使用Git将项目上传到Github/</id>
    <published>2019-08-17T02:43:04.000Z</published>
    <updated>2019-08-31T02:45:29.152Z</updated>
    
    <content type="html"><![CDATA[<h2 id="准备配置"><a href="#准备配置" class="headerlink" title="准备配置"></a>准备配置</h2><p>使用idea开发工具创建了一个project之后，此时项目代码是没有版本管理控制的，只是存放在本地。<br>一方面没有办法团队协作开发，另一方面无法让别人共同观赏。</p><p>于是经过自己摸索了解到了IDEA2019版本的连接GitHub使用git上传项目</p><p>在上传项目之前需要先在idea中确认两个配置，一个是git的执行位置，电脑上没有安装git的需要提前安装，安装之后再idea的settings中搜索git然后配置刚刚安装的git目录文件，再点击右侧的Test按钮进行测试验证，出现successfully表示git可以正常使用</p><p><img src="image001.png" alt="Git"></p><h3 id="接下来在GitHub选项中添加自己的GitHub账号"><a href="#接下来在GitHub选项中添加自己的GitHub账号" class="headerlink" title="接下来在GitHub选项中添加自己的GitHub账号"></a>接下来在GitHub选项中添加自己的GitHub账号</h3><p><img src="image003.png" alt="Git"></p><p>添加完成以后，点击“+“下面的”√“确认添加。</p><h3 id="将IDEA上的项目上传到GitHub中"><a href="#将IDEA上的项目上传到GitHub中" class="headerlink" title="将IDEA上的项目上传到GitHub中"></a>将IDEA上的项目上传到GitHub中</h3><p>点击项目工具栏中的VCS，点击Share Project on GitHub</p><p><img src="image005.png" alt="Git"></p><p>点击share即可</p><p><img src="image007.png" alt="Git"></p><p>可以在上传之前添加描述(Description)</p><p><img src="image009.png" alt="Git"></p><p>选中要上传的项目，点击 Add 添加</p><p><img src="image011.png" alt="Git"></p><p>上传成功</p><p><img src="image013.png" alt="Git"></p><h3 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h3><p><img src="image015.png" alt="Git"></p><p>右键点击项目，可以对项目代码进行操作，例如Push,Pull等</p><p>点击<code>Show History</code>查看代码上传日志，方便共同修改代码时进行查看</p><p><img src="image017.png" alt="Git"></p><p>Git是一个强大的工具，日常和工作我们都离不开它，关于GIt的其他小技巧可以通过后面慢慢了解，不要着急，熟能生巧，</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;准备配置&quot;&gt;&lt;a href=&quot;#准备配置&quot; class=&quot;headerlink&quot; title=&quot;准备配置&quot;&gt;&lt;/a&gt;准备配置&lt;/h2&gt;&lt;p&gt;使用idea开发工具创建了一个project之后，此时项目代码是没有版本管理控制的，只是存放在本地。&lt;br&gt;一方面没有办法团
      
    
    </summary>
    
      <category term="GitHub" scheme="http://yoursite.com/categories/GitHub/"/>
    
    
      <category term="Git" scheme="http://yoursite.com/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>本地安装maven库与IDEA安装本地maven库</title>
    <link href="http://yoursite.com/2019/08/17/%E6%9C%AC%E5%9C%B0%E5%AE%89%E8%A3%85maven%E5%BA%93%E4%B8%8EIDEA%E5%AE%89%E8%A3%85%E6%9C%AC%E5%9C%B0maven%E5%BA%93/"/>
    <id>http://yoursite.com/2019/08/17/本地安装maven库与IDEA安装本地maven库/</id>
    <published>2019-08-17T02:42:54.000Z</published>
    <updated>2019-08-31T02:45:38.440Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>在Maven官网下载最新版的安装包：[下载链接]<a href="http://maven.apache.org/download.cgi" target="_blank" rel="noopener">http://maven.apache.org/download.cgi</a></p><p><img src="image001.png" alt="Maven"></p><p>将文件解压到D:\opt\Tool\maven目录下（可以自己设置目录）</p><h3 id="新建环境变量"><a href="#新建环境变量" class="headerlink" title="新建环境变量"></a>新建环境变量</h3><p>新建环境变量MAVEN_HOME，赋值<code>D:\opt\Tool\maven\</code></p><p><img src="image003.png" alt="Maven"></p><p>编辑环境变量Path，追加<code>%MAVEN_HOME%\bin\</code></p><p><img src="image005.png" alt="Maven"></p><h3 id="检查maven是否安装成功"><a href="#检查maven是否安装成功" class="headerlink" title="检查maven是否安装成功"></a>检查maven是否安装成功</h3><p>我们可以通过DOS命令检查一下我们是否安装成功：<br>(我使用cmd一直找不到mvn，但是使用git就可以)</p><p><img src="image007.png" alt="Maven"></p><h3 id="容易错误的地点"><a href="#容易错误的地点" class="headerlink" title="容易错误的地点"></a>容易错误的地点</h3><p>前面4步安装成功之前打开的cmd运行mvn -v命令不会成功</p><p>如果出现 JAVA_HOME 应该指向JDK而不是JRE  请检查环境变量PATH是否配置了JRE的地址,如果有就删除</p><p>请仔细检查JAVA_HOME,MAVEN_HOME 这两个变量的值不应该出现’;’(分号) 如果有就删除</p><p>请仔细检查PATH中每一个引入的最后是否有’;’(分号) 如果没有就加上</p><p>win10中编辑环境变量会自动分隔,不需要加’;’(分号)</p><h2 id="配置Maven本地仓库"><a href="#配置Maven本地仓库" class="headerlink" title="配置Maven本地仓库"></a>配置Maven本地仓库</h2><p>在<code>D:\opt\Tool\maven\</code>目录下新建<code>maven-repository</code>文件夹，该目录用作maven的本地库。</p><p>打开D:\Tool\maven\conf\settings.xml文件.</p><p>查找下面这行代码：</p><p><code>&lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;</code></p><p>localRepository节点默认是被注释掉的，需要把它移到注释之外，然后将localRepository节点的值改为我们创建的目录</p><p><code>D:\opt\Tool\maven\maven-repository</code></p><p><img src="image009.png" alt="Maven"></p><ul><li><p>localRepository节点用于配置本地仓库，本地仓库其实起到了一个缓存的作用，它的默认地址是 C:\Users\用户名.m2。</p></li><li><p>当我们从maven中获取jar包的时候，maven首先会在本地仓库中查找，如果本地仓库有则返回；如果没有则从远程仓库中获取包，并在本地库中保存。</p></li><li><p>此外，我们在maven项目中运行mvn install，项目将会自动打包并安装到本地仓库中。</p></li></ul><h3 id="查看是否配置成功"><a href="#查看是否配置成功" class="headerlink" title="查看是否配置成功"></a>查看是否配置成功</h3><p>在cmd里输入</p><p><code>mvn help:system</code></p><p>如果前面的配置成功，那么<code>D:\opt\Tool\maven\maven-repository</code>会出现一些文件。这些文件是通用jar包.</p><p><img src="image011.png" alt="Maven"></p><h2 id="IDE安装本地maven库"><a href="#IDE安装本地maven库" class="headerlink" title="IDE安装本地maven库"></a>IDE安装本地maven库</h2><p>Ctrl + Alt + s 打开设置，搜索Maven</p><p>在Mavenhome director选项中选择maven的安装目录。  </p><p>Maven home directory: D:\opt\Tool\maven\   此目录为本地maven仓库的目录</p><p>User settings file : D:\opt\Tool\maven\conf\settings.xml此目录为本地maven仓库的配置文件</p><p><img src="image013.png" alt="Maven"></p><p>点击ok后IDEA配置本地maven仓库正式成功!</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;前期准备&quot;&gt;&lt;a href=&quot;#前期准备&quot; class=&quot;headerlink&quot; title=&quot;前期准备&quot;&gt;&lt;/a&gt;前期准备&lt;/h2&gt;&lt;h3 id=&quot;下载&quot;&gt;&lt;a href=&quot;#下载&quot; class=&quot;headerlink&quot; title=&quot;下载&quot;&gt;&lt;/a&gt;下载&lt;/h
      
    
    </summary>
    
      <category term="Hadoop" scheme="http://yoursite.com/categories/Hadoop/"/>
    
    
      <category term="Hadoop" scheme="http://yoursite.com/tags/Hadoop/"/>
    
      <category term="Maven" scheme="http://yoursite.com/tags/Maven/"/>
    
  </entry>
  
  <entry>
    <title>初识Spark</title>
    <link href="http://yoursite.com/2019/08/13/%E5%88%9D%E8%AF%86Spark/"/>
    <id>http://yoursite.com/2019/08/13/初识Spark/</id>
    <published>2019-08-13T12:12:40.000Z</published>
    <updated>2019-08-13T12:31:52.110Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spark简介"><a href="#Spark简介" class="headerlink" title="Spark简介"></a>Spark简介</h1><h2 id="Spark是什么"><a href="#Spark是什么" class="headerlink" title="Spark是什么"></a>Spark是什么</h2><p>Spark是一个快读且通用的集群计算平台</p><h2 id="Spark的特点"><a href="#Spark的特点" class="headerlink" title="Spark的特点"></a>Spark的特点</h2><p>Spark应用程序可以使用R语言、Java、Scala和Python进行编写，极少使用R语言编写Spark程序，Java和Scala语言编写的Spark程序的执行效率是相同的，但Java语言写的代码量多，Scala简洁优雅，但可读性不如Java，Python语言编写的Spark程序的执行效率不如Java和Scala。</p><h3 id="Spark是快速的"><a href="#Spark是快速的" class="headerlink" title="Spark是快速的"></a>Spark是快速的</h3><ul><li>Spark扩充了流行的MapReduce计算模型</li><li>Spark是基于内存的计算</li></ul><h3 id="Spark是通用的"><a href="#Spark是通用的" class="headerlink" title="Spark是通用的"></a>Spark是通用的</h3><ul><li>Spark的设计容纳了其他分布式系统拥有的功能</li><li>批处理，迭代式计算，交互查询和流处理等</li><li>优点：降低了维护成本</li></ul><h3 id="Spark是高度开放的"><a href="#Spark是高度开放的" class="headerlink" title="Spark是高度开放的"></a>Spark是高度开放的</h3><ul><li>Spark提供了Python，Java，Scala，Sql的API和丰富的内置库。</li><li>Spark和其他的大数据工具整合的很好，包括hadoop，kafka等</li></ul><h3 id="Spark有4中运行模式"><a href="#Spark有4中运行模式" class="headerlink" title="Spark有4中运行模式"></a>Spark有4中运行模式</h3><ul><li>local模式，适用于测试</li><li>standalone，并非是单节点，而是使用spark自带的资源调度框架</li><li>yarn，最流行的方式，使用yarn集群调度资源</li><li>mesos，国外使用的多</li></ul><h2 id="Spark生态"><a href="#Spark生态" class="headerlink" title="Spark生态"></a>Spark生态</h2><h3 id="Spark历史"><a href="#Spark历史" class="headerlink" title="Spark历史"></a>Spark历史</h3><p>Spark是美国加州大学伯克利分校的AMP实验室（主要创始人lester和Matei）开发的通用的大数据处理框架。</p><h3 id="Spark的组件"><a href="#Spark的组件" class="headerlink" title="Spark的组件"></a>Spark的组件</h3><p>Spark包括多个紧密集成的组件：</p><p><img src="image001.png" alt="Spark"></p><h4 id="Spark-Core："><a href="#Spark-Core：" class="headerlink" title="Spark Core："></a>Spark Core：</h4><p>包含Spark的基本功能，包含任务调度，内存管理，容错机制等。</p><p>内部定义了RDDs（弹性分布式数据集）。</p><p>提供了很多APIs来创建和操作这些RDDs。</p><p>应用场景:为其他组件提供底层的服务。</p><h4 id="Spark-SQL："><a href="#Spark-SQL：" class="headerlink" title="Spark SQL："></a>Spark SQL：</h4><p>是Spark处理结构化数据的库，就像Hive SQL，MySQL一样。</p><p>应用场景:企业中用来做报表统计</p><h4 id="Spark-Streaming："><a href="#Spark-Streaming：" class="headerlink" title="Spark Streaming："></a>Spark Streaming：</h4><p>是实时数据流处理组件，类似Storm。</p><p>Spark Streaming提供了API来操作实时流数据。</p><p>应用场景:企业中用来从kafka接受数据做实时统计。</p><h4 id="Milb："><a href="#Milb：" class="headerlink" title="Milb："></a>Milb：</h4><p>一个包含通用机器学习功能的包，Machine learning lib</p><p>包含分类，聚类，回归等，还包括模型评估，和数据导入</p><p>MLlib提供的上面的这些方法，都支持集群上的横向扩展</p><blockquote><p>平常我们做机器学习用Python较多，Python最大的缺点是在单机上的，它处理的数据是有限的，而Milb是基于集群的</p></blockquote><p>应用场景，机器学习</p><h4 id="Graphx："><a href="#Graphx：" class="headerlink" title="Graphx："></a>Graphx：</h4><p>是处理图的库（例如，社交网络图），并进行图的并行计算。</p><p>像Spark Streaming，Spark SQL一样，它也继承了RDD API。</p><p>它提供了各种图的操作，和常用的图算法，例如PageRank算法。</p><p>应用场景，图计算。</p><h4 id="Cluster-Managers："><a href="#Cluster-Managers：" class="headerlink" title="Cluster Managers："></a>Cluster Managers：</h4><p>就是集群管理，Spark自带一个集群管理是单独调度器。</p><p>常见集群管理包括Hadoop YARN，Apache Mesos</p><p>紧密继承的优点：</p><ul><li>Spark底层优化了，基于Spark底层的组件，也得到了相应的优化。</li><li>紧密集成，节省了各个组件结合使用时的部署，测试等时间。</li><li>向Spark增加新的组件时，其他组件，可立即享用新组建的功能</li></ul><h2 id="Spark与Hadoop的比较"><a href="#Spark与Hadoop的比较" class="headerlink" title="Spark与Hadoop的比较"></a>Spark与Hadoop的比较</h2><h3 id="Hadoop的应用场景"><a href="#Hadoop的应用场景" class="headerlink" title="Hadoop的应用场景"></a>Hadoop的应用场景</h3><h4 id="离线处理"><a href="#离线处理" class="headerlink" title="离线处理"></a>离线处理</h4><p>Hadoop在处理数据的时候它的中间数据会落到硬盘上，因此导致Hadoop处理大量数据时时效性不是很高。</p><p>Hadoop任务的执行时间是几分钟到几小时不等</p><p>对时效性要求不高</p><h4 id="Spark应用场景"><a href="#Spark应用场景" class="headerlink" title="Spark应用场景"></a>Spark应用场景</h4><p>时效性要求高的场景</p><p>因为Spark是基于内存的，它的中间数据尽量不落在磁盘上，尽量落在内存中，这样就大大加快了Spark的运算速度</p><p>Spark的计算时间一般是几秒钟到几分钟</p><p>机器学习等领域</p><ul><li>这是一整个生态系统，每个组件都有其作用，各善其职即可</li><li>Spark不具有HDFS的存储能力，要借助HDFS等持久化数据</li><li>大数据将会孕育出更多的新技术</li></ul><h3 id="RDDs介绍"><a href="#RDDs介绍" class="headerlink" title="RDDs介绍"></a>RDDs介绍</h3><h4 id="Driver-program："><a href="#Driver-program：" class="headerlink" title="Driver program："></a>Driver program：</h4><p>包含程序的main（）方法，RDDs的定义和操作。<br>它管理很多节点，我们称作<code>executors</code></p><p><img src="image003.png" alt="Spark"></p><h4 id="SparkContext："><a href="#SparkContext：" class="headerlink" title="SparkContext："></a>SparkContext：</h4><p>Driver programs通过SparkContext对象访问Spark。</p><p>SparkContext对象代表和一个集群的连接。</p><p>在Shell中SparkContext自动创建好了，就是sc。</p><h4 id="RDDs："><a href="#RDDs：" class="headerlink" title="RDDs："></a>RDDs：</h4><p>Resilient distributed datasets（弹性分布式数据集，简写RDDs）</p><p>这些RDDs，并行的分布在整个集群中</p><p>RDDs是Spark分发数据和计算的基础抽象类。</p><p>一个RDD是一个不可改变的分布式集合对象</p><p>Spark中，所有的计算都是通过RDDs的创建，转换，操作完成的。</p><p>一个RDD内部由许多partitions（分片）组成。</p><h5 id="分片："><a href="#分片：" class="headerlink" title="分片："></a>分片：</h5><p>每个分片包括一部分数据，partitions可在集群不同节点上计算</p><p>分片是Spark并行处理的单元，Spark顺序的，并行的处理分片</p><h5 id="RDDs的创建方法："><a href="#RDDs的创建方法：" class="headerlink" title="RDDs的创建方法："></a>RDDs的创建方法：</h5><p>把一个存在的集合传给SparkContext的parallelize()方法，测试用</p><p><code>val rdd = sc.parallelize(Array(1,2,2,4),4)</code></p><p>第一个参数：待并行化处理的集合，第二个参数：分区个数</p><p>加载外部数据集。</p><p><code>val rddText = sc.textFile(&quot;helloSpark.txt&quot;)</code></p><h2 id="Scala的基础知识"><a href="#Scala的基础知识" class="headerlink" title="Scala的基础知识"></a>Scala的基础知识</h2><h3 id="Scala的变量声明："><a href="#Scala的变量声明：" class="headerlink" title="Scala的变量声明："></a>Scala的变量声明：</h3><p>在Scala中创建变量的时候，必须使用val或者var</p><p>val，变量值不可修改，一旦分配不能重新指向别的值</p><p>var，分配后，可以指向类型相同的值</p><h3 id="Scala的匿名函数和类型推断："><a href="#Scala的匿名函数和类型推断：" class="headerlink" title="Scala的匿名函数和类型推断："></a>Scala的匿名函数和类型推断：</h3><p><code>lines.filter(line=&gt;line.contains(&quot;world&quot;))</code></p><p>定义一个匿名函数，接受一个参数line，</p><p>使用line这个String类型变量上的contains方法，并且返回结果。</p><p>line的类型不需指定，能够推断出来。</p><h2 id="RDD基本操作之Transformation"><a href="#RDD基本操作之Transformation" class="headerlink" title="RDD基本操作之Transformation"></a>RDD基本操作之Transformation</h2><h3 id="Transformation介绍："><a href="#Transformation介绍：" class="headerlink" title="Transformation介绍："></a>Transformation介绍：</h3><h4 id="Transformations（转换）"><a href="#Transformations（转换）" class="headerlink" title="Transformations（转换）"></a>Transformations（转换）</h4><p>从之前的RDD构建一个新的RDD，像map()和filter().</p><h4 id="map"><a href="#map" class="headerlink" title="map():"></a>map():</h4><p>map()接受函数，把函数应用到RDD的每一个元素，返回新RDD。</p><h4 id="filter"><a href="#filter" class="headerlink" title="filter():"></a>filter():</h4><p>filter()接受函数，返回只包含满足filter()函数的元素的新RDD。</p><h4 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap():"></a>flatMap():</h4><p>对每个输入元素，输出多个输出元素。</p><p>flat压扁的意思，将RDD中元素压扁后返回一个新的RDD.</p><h2 id="RDD基本操作之Action"><a href="#RDD基本操作之Action" class="headerlink" title="RDD基本操作之Action"></a>RDD基本操作之Action</h2><h3 id="Action介绍："><a href="#Action介绍：" class="headerlink" title="Action介绍："></a>Action介绍：</h3><p>在RDD上计算出来一个结果。</p><p>把结果返回给driver program或保存在文件系统，count(),save</p><p><img src="image005.png" alt="Spark"></p><p><img src="image007.png" alt="Spark"></p><h3 id="常用函数举例："><a href="#常用函数举例：" class="headerlink" title="常用函数举例："></a>常用函数举例：</h3><h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce()"></a>reduce()</h4><p>接收一个函数，作用在RDD两个类型相同的元素上，返回新元素。<br>可以实现，RDD中元素的累加，计数，和其他类型的聚集操作。</p><p><img src="image009.png" alt="Spark"></p><p><img src="image011.png" alt="Spark"></p><h4 id="Collect-："><a href="#Collect-：" class="headerlink" title="Collect()："></a>Collect()：</h4><p>遍历整个RDD，向driver program返回RDD的内容</p><p>需要单机内存能够容纳下（因为数据要拷贝给driver，测试使用）</p><p>大数据的时候，使用savaAsTextFile() action等。</p><h4 id="take-n-："><a href="#take-n-：" class="headerlink" title="take(n)："></a>take(n)：</h4><p>返回RDD的n个元素（同时尝试访问最少的partitions）</p><p>返回结果是无序的，测试使用</p><h4 id="top-："><a href="#top-：" class="headerlink" title="top()："></a>top()：</h4><p>排序（根据RDD中数据的比较器）</p><h4 id="foreach-："><a href="#foreach-：" class="headerlink" title="foreach()："></a>foreach()：</h4><p>计算RDD中的每个元素，但不返回到本地。</p><p>可以配合println()友好的打印出数据。</p><h2 id="RDDs的特性"><a href="#RDDs的特性" class="headerlink" title="RDDs的特性"></a>RDDs的特性</h2><p><strong>RDDs的血统关系图：</strong></p><p><img src="image013.png" alt="Spark"></p><p>Spark维护者RDDs之间的依赖关系和创建关系，叫做血统关系图</p><p>Spark使用血统关系图来计算每个RDD的需求和恢复丢失的数据</p><h3 id="延迟计算（Lazy-Evaluation）："><a href="#延迟计算（Lazy-Evaluation）：" class="headerlink" title="延迟计算（Lazy Evaluation）："></a>延迟计算（Lazy Evaluation）：</h3><p>Spark对RDDs的计算是，他们第一次使用action操作的时候</p><p>这种方式在处理大数据的时候特别有用，可以减少数据的传输</p><p>Spark内部记录metadata表名transformations操作已经被响应了</p><p>加载数据也是延迟计算，数据只有在必要的时候，才会被加载进去</p><h3 id="RDD-persist"><a href="#RDD-persist" class="headerlink" title="RDD.persist():"></a>RDD.persist():</h3><p>默认每次在RDDs上面进行action操作时，Spark都重新计算RDDs</p><p>如果想重复利用一个RDD，可以使用RDD.persist()</p><p>unpersist()方法从缓存中移除</p><p>例子-peisist()</p><p><img src="image015.png" alt="Spark"></p><p><img src="image017.png" alt="Spark"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Spark简介&quot;&gt;&lt;a href=&quot;#Spark简介&quot; class=&quot;headerlink&quot; title=&quot;Spark简介&quot;&gt;&lt;/a&gt;Spark简介&lt;/h1&gt;&lt;h2 id=&quot;Spark是什么&quot;&gt;&lt;a href=&quot;#Spark是什么&quot; class=&quot;headerli
      
    
    </summary>
    
      <category term="Spark" scheme="http://yoursite.com/categories/Spark/"/>
    
    
      <category term="Spark" scheme="http://yoursite.com/tags/Spark/"/>
    
  </entry>
  
  <entry>
    <title>Java中“==”与equeals的区别</title>
    <link href="http://yoursite.com/2019/08/13/Java%E4%B8%AD%E2%80%9C-%E2%80%9D%E4%B8%8Eequeals%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
    <id>http://yoursite.com/2019/08/13/Java中“-”与equeals的区别/</id>
    <published>2019-08-13T11:58:48.000Z</published>
    <updated>2019-08-17T02:49:05.203Z</updated>
    
    <content type="html"><![CDATA[<h2 id><a href="#" class="headerlink" title="=="></a>==</h2><p><code>==</code>是比较两个变量的值，如果是基本数据类型，那么就是比较的基本数据的大小值</p><h3 id="情况一"><a href="#情况一" class="headerlink" title="情况一"></a>情况一</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> b=<span class="number">1</span>;</span><br><span class="line">System.out.println(a==b);</span><br></pre></td></tr></table></figure><p><img src="image001.png" alt="Java"></p><p>以上图中：==比较的就是上面两个内存块中的值，都是1，所以是true</p><p>但是如果存储的是引用类型，其实比较的还是变量本身所存储的值，我们都知道，<br>变量存储引用类型其实存储的只是引用对象的地址作为值存储到变量中，那么当用==<br>判断时，比较的就是这两个<strong>地址值</strong>了，所以说==比的是两个变量所存储的值，</p><p>至于这个值是什么类型的，就看放什么了</p><h3 id="情况二"><a href="#情况二" class="headerlink" title="情况二"></a>情况二</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User a = <span class="keyword">new</span> User();</span><br><span class="line">User b = <span class="keyword">new</span> User();</span><br><span class="line">System.out.println(a==b);</span><br></pre></td></tr></table></figure><p><img src="image003.png" alt="Java"></p><p>在上图中，a和b存的就是一个引用对象，在这时判断a==b时，比较的也是a和b所存储的值，</p><p>可以看出，a里面存的是0x1234，b里面存放的是0x5874,很明显不相等，所以是false</p><h3 id="情况三"><a href="#情况三" class="headerlink" title="情况三"></a>情况三</h3><p>而当使用==比较字符串时：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String a=<span class="string">"abcd"</span>;</span><br><span class="line">String b=<span class="string">"abcd"</span>;</span><br><span class="line">System.out.println(a==b);</span><br></pre></td></tr></table></figure><p><img src="image005.png" alt="Java"></p><p>这时，a和b存储的是同一个常量字符串，地址也一样，所以是true。</p><h3 id="情况四"><a href="#情况四" class="headerlink" title="情况四"></a>情况四</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String a=<span class="keyword">new</span> String(<span class="string">"abcd"</span>);</span><br><span class="line">String b=<span class="keyword">new</span> String(<span class="string">"abcd"</span>);</span><br><span class="line">System.out.printlnl(a==b);</span><br></pre></td></tr></table></figure><p><img src="image007.png" alt="Java"></p><p>如果通过创建对象的方式创建字符串，那么流程就会向上图一样，a和b里面所存放的值就不一样了，a和b 比较就是false</p><h2 id="equals"><a href="#equals" class="headerlink" title="equals()"></a>equals()</h2><p>JAVA当中所有的类都是继承于<code>Object</code>这个超类的，在Object类中定义了一个equals的方法，equals的源码是这样写的：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//this - s1</span></span><br><span class="line">    <span class="comment">//obj - s2</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">this</span> == obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，这个方法的初始默认行为是比较对象的内存地址值，一般来说，意义不大。所以，在一些类库当中这个方法被重写了，如String、Integer、Date。在这些类当中equals有其自身的实现（一般都是用来比较对象的成员变量值是否相同），而不再是比较类在堆内存中的存放地址了。</p><p>所以说，对于复合数据类型之间进行equals比较，在没有覆写equals方法的情况下，他们之间的比较还是内存中的存放位置的地址值，跟双等号（==）的结果相同；如果被复写，按照复写的要求来。</p><h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  String s1 = "a";</span></span><br><span class="line"><span class="comment">    String s2 = "b";</span></span><br><span class="line"><span class="comment">    String s3 = "c";</span></span><br><span class="line"><span class="comment">    String s4 = "abc";</span></span><br><span class="line"><span class="comment">    String s5 = s1+s2+s3;</span></span><br><span class="line"><span class="comment">    System.out.println(s4 == s5);</span></span><br><span class="line"><span class="comment">    System.out.println(s4.equals(s5));</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">    String s1 = <span class="string">"a"</span> + <span class="string">"b"</span> + <span class="string">"c"</span>;</span><br><span class="line">    String s2 = <span class="string">"abc"</span>;</span><br><span class="line">    System.out.println(s1 == s2);</span><br><span class="line">    System.out.println(s1.equals(s2));</span><br></pre></td></tr></table></figure><p>地址值的话，由于String是常量，存放于常量池中。而Java中对于常量有常量优化机制，所以没有注释的部分，在编译时候，就是将abc相加的结果赋值给s1，又发现常量池中已经有了abc，所以s1和s2指向的是常量池中的同一个abc，而注释的部分，由于是变量相加，运行时会在常量池中创建新的abc，所以是两个不同的abc</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title=&quot;==&quot;&gt;&lt;/a&gt;==&lt;/h2&gt;&lt;p&gt;&lt;code&gt;==&lt;/code&gt;是比较两个变量的值，如果是基本数据类型，那么就是比较的基本数据的大小值&lt;/p&gt;
&lt;h3 id=&quot;情况一&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Java编程思想学习笔记(二)</title>
    <link href="http://yoursite.com/2019/08/10/Java%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BA%8C/"/>
    <id>http://yoursite.com/2019/08/10/Java编程思想学习笔记-二/</id>
    <published>2019-08-10T02:50:06.000Z</published>
    <updated>2019-08-10T05:39:23.991Z</updated>
    
    <content type="html"><![CDATA[<h1 id="初始化与清理"><a href="#初始化与清理" class="headerlink" title="初始化与清理"></a>初始化与清理</h1><blockquote><p>随着计算机革命的发展，“不安全”的编程方式已逐渐成为编程代价高昂的主因之一,初始化与清理正是涉及安全的两个问题。</p></blockquote><p>许多c程序的错误都源于程序员忘记初始化变量。清理也是一个特殊问题，当使用完一个元素时，它对你也就不会有什么影响了，所以很容易把它忘记。这样一来，这个元素占有的资源就会一直得不到释放，结果是资源（尤其是内存）用尽。</p><p>Java中采用了<strong>构造器</strong>，这是一个在创建对象时被自动调用的特殊方法，并额外提供了“垃圾回收器”。对于不再使用的内存资源，垃圾回收器能自动将其释放。</p><h2 id="用构造器确保初始化"><a href="#用构造器确保初始化" class="headerlink" title="用构造器确保初始化"></a>用构造器确保初始化</h2><p>可以假想为编写的每个类都定义一个<code>initialize()</code>方法。</p><p>该方法的名称题型你在使用其对象之前，应首先调用<code>initialize()</code></p><p>在Java中，通过提供构造器，类的设计者可确保每个对象都会得到初始化。创建对象时，如果其类具有构造器，Java就会在用户有能力操作对象之前自动调用相应的构造器，从而保证了初始化的进行。</p><h3 id="如何命名"><a href="#如何命名" class="headerlink" title="如何命名"></a>如何命名</h3><p>构造器采用与类相同的名称。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rock</span> </span>&#123;</span><br><span class="line">    Rock() &#123;</span><br><span class="line">        System.out.print(<span class="string">"Rock "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleConstructor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">new</span> Rock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">输出：</span><br><span class="line">    Rock Rock Rock Rock Rock Rock Rock Rock Rock Rock</span><br></pre></td></tr></table></figure><p>现在，在创建对象时：</p><p><code>new Rock();</code></p><p>将会为对象分配存储空间，并调用相应构造器。</p><p>不接受任何参数的构造器叫做<strong>默认构造器</strong>。和其他方法一样，构造器也能带有形式参数，以便指定如何创建对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rock2</span> </span>&#123;</span><br><span class="line">    Rock2(<span class="keyword">int</span> i) &#123;</span><br><span class="line">        System.out.print(<span class="string">"Rock "</span> + i + <span class="string">" "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleConstructor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">new</span> Rock2(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">输出：</span><br><span class="line">    Rock <span class="number">0</span> Rock <span class="number">1</span> Rock <span class="number">2</span> Rock <span class="number">3</span> Rock <span class="number">4</span> Rock <span class="number">5</span></span><br></pre></td></tr></table></figure><p>有了构造器形式参数，就可以在初始化对象时提供实际参数。例如假设类Tree有一个构造器，它接受一个整型变量来表示数的高度</p><p><code>Tree t = new Tree(12);</code></p><p>如果<code>Tree(int)</code>是<code>Tree</code>类中唯一的构造器，那么编译器将不会允许你以其他任何方式创建<code>Tree</code>对象。</p><p>构造器有助于减少错误，并且使代码更易于阅读。<strong>在Java中，“初始化”和“创建”捆绑在一起，两者不能分离</strong></p><p>构造器是一种特殊类型的方法，因为它没有返同值。</p><p>这与返回值为空(void)明显不同。对于空返回值，尽管方法本身不会自动返回什么，但仍可选择让它返回别的东西。</p><p>构造器则不会返回任何东西，你别无选择(new表达式确实返回了对新建对象的引用，但构造器本身并没有任何返回值)。假如构造器具有返回值，并且允许人们自行选择返回类型，那么势必得让编译器知道该如何处理此返回值。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;初始化与清理&quot;&gt;&lt;a href=&quot;#初始化与清理&quot; class=&quot;headerlink&quot; title=&quot;初始化与清理&quot;&gt;&lt;/a&gt;初始化与清理&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;随着计算机革命的发展，“不安全”的编程方式已逐渐成为编程代价高昂的主因之一,初始化
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Java编程思想学习笔记</title>
    <link href="http://yoursite.com/2019/08/10/Java%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2019/08/10/Java编程思想学习笔记/</id>
    <published>2019-08-10T02:42:19.000Z</published>
    <updated>2019-08-10T02:50:29.713Z</updated>
    
    <content type="html"><![CDATA[<h1 id="对象导论"><a href="#对象导论" class="headerlink" title="对象导论"></a>对象导论</h1><h2 id="抽象过程"><a href="#抽象过程" class="headerlink" title="抽象过程"></a>抽象过程</h2><p>所有编程语言都提供抽象机制。<br>万物皆为对象<br>程序是对象的集合，它们通过发送消息来告知彼此所要做的。<br>每个对象都有自己的由其他对象所构成的存储<br>每个对象都拥有其类型<br>某一特定类型的所有对象都可以接受同样的消息<br>对象具有状态，行为和标识</p><h2 id="每个对象都有一个接口"><a href="#每个对象都有一个接口" class="headerlink" title="每个对象都有一个接口"></a>每个对象都有一个接口</h2><p>怎样才能获取有用的对象？必须有某种方式产生对对象的请求，是对象完成各种任务，如完成一笔交易，在屏幕上画图，打开开关等。每个对象都只能满足某些请求，这些请求有对象的接口（interface）所定义，决定接口的便是类型。<br>以电灯泡为例来做一个简单的比喻：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Light lt = <span class="keyword">new</span> Litght();</span><br><span class="line">lt.on();</span><br></pre></td></tr></table></figure><p><strong>接口确定了对某一特定对象所能发出的请求。</strong></p><p>上例中，类型/类的名称是Light，特定的Light对象的名词是It，可以向Light对象发出的请求是：打开它，关闭它，将它调亮，将它调暗。你以下列方式创建了一个Light对象：定义这个对象的‘引用’(It)，然后调用new方法来创建该类型的新对象。为了向对象发送消息，需要声明对象的名称，并以圆点符号连接一个消息请求。</p><h2 id="每个对象都提供服务"><a href="#每个对象都提供服务" class="headerlink" title="每个对象都提供服务"></a>每个对象都提供服务</h2><p>程序本身将向用户提供服务，他将通过调用其他对象提供的服务来实现这一目的。</p><h2 id="被隐藏的具体实现"><a href="#被隐藏的具体实现" class="headerlink" title="被隐藏的具体实现"></a>被隐藏的具体实现</h2><p>java用三个关键字在类的内部设定边界，public，private，protected<br>java还有一种默认的访问权限，当没有使用前面提到的任何访问指定词时，它将发挥作用。这种权限通常被称为包访问权限</p><h2 id="复用具体实现"><a href="#复用具体实现" class="headerlink" title="复用具体实现"></a>复用具体实现</h2><p>代码复用是面向对象程序设计语言所提供的的最了不起的优点之一。</p><h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><p>当继承现有类型时，也就创造了新的类型。这个新的类型不仅包括现有类型的所有成员（尽管private成员被隐藏，并且不可访问），而且更重要的是它复制了基类的接口。也就是说，所有可以发送给基类对象的消息同时也可以发送给导出类对象。导出类与基类具有相同的类型。</p><p>一个圆形也是一个几何形。</p><p>有两种方法可以使基类与导出类产生差异。<br>直接在导出类中添加新方法，这个新方法并不是基类接口的一部分。<br>覆改变现有基类的方法，覆盖。</p><h2 id="伴随多态的可互换对象"><a href="#伴随多态的可互换对象" class="headerlink" title="伴随多态的可互换对象"></a>伴随多态的可互换对象</h2><p>面向对象程序设计的最重要的妙诀:编译器不可能产生传统意义上的函数调用。</p><p>如果用Java来编写一个方法(后面很快你就会学习如何编写):</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doSomething</span><span class="params">(Shape shape)</span></span>&#123;</span><br><span class="line">    shape.erase();</span><br><span class="line">    shape.draw();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个方法可以与任何Shape对话，因此它是独立于任何它要绘制和擦除的对象的其体类型的。</p><p>如果程序中其他部分用到了doSomething()方法:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Circle CirCie，<span class="keyword">new</span> Circle();</span><br><span class="line">Triangle triangle = <span class="keyword">new</span> triangle();</span><br><span class="line">Line line = <span class="keyword">new</span> Line():</span><br><span class="line">doSomething(circle);</span><br><span class="line">doSomething(triangle);</span><br><span class="line">doSomething(line);</span><br></pre></td></tr></table></figure><p>对doSomething()的调用会白动地正确处理，而不管对象的确切类型。</p><p>这是一个相当令人惊奇的诀窍。看看下面这行代码:</p><p><code>doSomething(circle);</code></p><p>当Circle被传入到预期接收Shape的方法中，究竟会发生什么。由于Circle可以被doSomething() 看作是Shape，也就是说，doSomething()可以发送给Shape的任何消息，Circle都可以接收，那么，这么做是完全安全且合乎逻辑的。</p><h2 id="单根继承结构"><a href="#单根继承结构" class="headerlink" title="单根继承结构"></a>单根继承结构</h2><p>在OOP中，自c++面世以来就己变得非常瞩目的一个问题就是，是否所有的类最终都继承自单一的基类。在java中(事实上还包括除C++以外的所有OOP语言)，答案是yes，这个终极基类的名字就是<strong>Object</strong>。事实证明，单根继承结构带来了很多好处。</p><p>在单根继承结构中的所有对象都具有一个共用接口，所以它们归根到底都是相同的基本类型。</p><h2 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h2><p>这个通常被称为容器(也称为集合，不过Java类库以不同的含义使用“集合”这个术语，所以本书使用“容器”这个词)的新对象，在任何需要时都可扩充自己以容纳你置于其中的所有东西。因此不需要知道将来会把多少个对象置于容器中，只需要创建一个容器对象，然后让它处理所有细节。</p><h2 id="对象的创建和生命期"><a href="#对象的创建和生命期" class="headerlink" title="对象的创建和生命期"></a>对象的创建和生命期</h2><p>在使用对象时，最关键的问题之一便是他们的生成和销毁方式。每个对象为了生存都需要资源，尤其是内存。当我们不再需要一个对象时，它必须被清理掉，使其占有的资源被释放和重用。</p><p>Java完全采用了动态内存分配方式。每当想要创建新对象时，就要使用new关键字来构建此对象的动态实例。</p><p>Java提供了<strong>垃圾回收器</strong>的机制，它可以自动发现对象何时不再被使用，并继而销毁它。</p><h2 id="异常处理：处理错误"><a href="#异常处理：处理错误" class="headerlink" title="异常处理：处理错误"></a>异常处理：处理错误</h2><p> 异常处理将错误处理直接置于编程语言中，有时甚至置于操作系统中。异常是一种对象，它从出错地点被“抛出’，并被专门设计用来处理特定类型错误的相应的异常处理器“捕获”。异常处理就像是与程序正常执行路径并行的、在错误发生时执行的另一条路径。因为它是另一条完全分离的执行路径，所以它不会干扰正常的执行代码。这往往使得代码编写变得简单，因为不需要被迫定期检查错误。</p><p>此外，被抛出的异常不像方法返回的错误值和方法设置的用来表示错误条件的标志位那样可以被忽略。异常不能被忽略，所以它保证一定会在某处得到处理。</p><p>最后需要指出的是：异常提供了一种从错误状况进行可靠恢复的途径。现在不再是只能退出程序，你可以经常进行校正，并恢复程序的执行，这些都有助于编写出更健壮的程序。<br>Java的异常处理在众多的编程语言中格外引人注目，因为Java一开始就内置了异常处理，而且强制你必须使用它。</p><h2 id="并发编程"><a href="#并发编程" class="headerlink" title="并发编程"></a>并发编程</h2><p>在计算机编程中有一个基本概念。就是在同一时刻处理多个任务的思想。许多程序设计问题都要求，程序能够停下正在做的工作，转而处理某个其他问题。然后再返回主进程。</p><p>有时中断对于处理时间性强的任务是必需的，但是对于大量的其他问题，我们只是想把问题切分成多个可独立运行的部分(任务)，从而提高程序的响应能力。在程序中，这些彼此独立运行的部分称之为线程，上述概念被称为“并发”。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>你知道过程型语一言看起来像什么样子：数据定义和函数调用。想了解此类程序的含义，你必须忙上一阵，需要通读函数调用和低层概念，以在脑海里建立一个模型。这正是我们在设计过程式程序时，需要中间表示形式的原因。这些程序总是容易把人搞糊涂，因为它们使用的表示术语更加面向计算机而不是你要解决的问题。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;对象导论&quot;&gt;&lt;a href=&quot;#对象导论&quot; class=&quot;headerlink&quot; title=&quot;对象导论&quot;&gt;&lt;/a&gt;对象导论&lt;/h1&gt;&lt;h2 id=&quot;抽象过程&quot;&gt;&lt;a href=&quot;#抽象过程&quot; class=&quot;headerlink&quot; title=&quot;抽象过程&quot;&gt;&lt;/a
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
</feed>
